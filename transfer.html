<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Transfer — CITI</title>

  <!-- Minimal luxury CSS matching typical withdraw page styles -->
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa4b2;
      --accent:#7c5cff;
      --glass: rgba(255,255,255,0.03);
      --success:#3bd671;
      --danger:#ff6b6b;
      --gold: linear-gradient(90deg,#ffd166,#f9a826);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(124,92,255,0.12), transparent 8%),
                  radial-gradient(900px 400px at 90% 90%, rgba(0,200,190,0.05), transparent 10%),
                  var(--bg);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
    }

    .container{
      width:960px;
      max-width:96%;
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:24px;
      align-items:start;
    }

    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
      border:1px solid rgba(255,255,255,0.04);
      padding:22px;
      border-radius:12px;
      box-shadow: 0 6px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    }

    .brand-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo{
      width:48px;height:48px;border-radius:10px;
      background:linear-gradient(135deg,#fff 0%, #f0f0f0 100%);
      box-shadow: 0 6px 18px rgba(124,92,255,0.14);
    }
    .title{
      font-weight:600;
      letter-spacing:0.2px;
      font-size:16px;
      color:#f4f7fb;
    }
    .subtitle{
      font-size:12px;color:var(--muted);margin-top:2px;
    }

    form .row{
      display:flex;gap:12px;margin-bottom:12px;
    }
    label{
      display:block;font-size:13px;color:var(--muted);margin-bottom:8px;
    }

    input[type="text"], input[type="number"], select, textarea{
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.03);
      color:#e8f0ff;
      font-size:14px;
      outline:none;
      box-shadow: none;
    }

    .note{
      font-size:13px;color:var(--muted);margin-top:8px;
    }

    .balance-card{
      display:flex;flex-direction:column;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.006));
      border:1px solid rgba(255,255,255,0.03);
    }

    .balance-label{font-size:13px;color:var(--muted)}
    .balance-amount{font-size:28px;font-weight:700;margin-top:6px;color:#fff;letter-spacing:0.6px}

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:12px 16px;
      border-radius:10px;
      cursor:pointer;
      border:0;
      font-weight:600;
      color:#08101a;
      background:linear-gradient(90deg,var(--accent),#5ec9ff);
      box-shadow: 0 8px 30px rgba(124,92,255,0.14);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn-danger{
      color:#fff;background:linear-gradient(90deg,#ff6b6b,#ff4d4d);
      box-shadow: 0 8px 24px rgba(255,107,107,0.12);
    }

    .muted-block{font-size:13px;color:var(--muted);margin-top:8px}

    .history-list{
      margin-top:12px;
      display:flex;flex-direction:column;gap:10px;
      max-height:320px;overflow:auto;padding-right:6px;
    }
    .tx{
      padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center;border:1px solid rgba(255,255,255,0.02);
    }
    .tx .left{display:flex;flex-direction:column}
    .tx .title{font-weight:600;font-size:14px}
    .tx .meta{font-size:12px;color:var(--muted);margin-top:4px}
    .tx .amount{font-weight:700}

    .helper{
      font-size:13px;color:var(--muted);margin-top:6px;
    }

    /* Print styles for receipt window */
    @media print {
      body *{visibility:hidden}
      #printable, #printable *{visibility:visible}
      #printable{position:fixed;left:0;top:0;width:100%}
    }

    /* Responsive */
    @media (max-width:900px){
      .container{grid-template-columns:1fr;gap:16px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="panel">
      <div class="brand-row">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <div class="title">Transfer Funds</div>
            <div class="subtitle">Send money securely to another account</div>
          </div>
        </div>
        <div class="muted-block">Account: <strong id="accountId">—</strong></div>
      </div>

      <form id="transferForm" autocomplete="off" novalidate>
        <div class="row">
          <div style="flex:1">
            <label for="toAccount">Recipient Account Number</label>
            <input id="toAccount" name="toAccount" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="1234567890" required />
          </div>
          <div style="width:160px">
            <label for="currency">Currency</label>
            <select id="currency" name="currency" required>
              <option value="USD">USD</option>
              <option value="NZD">NZD</option>
              <option value="JPY">JPY</option>
              <option value="EUR">EUR</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div style="flex:1">
            <label for="amount">Amount</label>
            <input id="amount" name="amount" type="number" min="0.01" step="0.01" placeholder="0.00" required />
            <div class="helper">All transfers are final. Ensure recipient details are correct.</div>
          </div>
          <div style="width:200px">
            <label for="type">Transfer Type</label>
            <select id="type" name="type">
              <option value="internal">Internal</option>
              <option value="external">External</option>
            </select>
          </div>
        </div>

        <div style="margin-top:8px">
          <label for="note">Reference / Note (optional)</label>
          <input id="note" name="note" type="text" placeholder="Invoice 2025-09-01" />
        </div>

        <div style="display:flex;gap:12px;margin-top:16px;align-items:center">
          <button type="submit" class="btn" id="sendBtn">Send Transfer</button>
          <button type="button" id="resetBtn" class="btn btn-danger" style="background:transparent;color:var(--muted);box-shadow:none;border:1px solid rgba(255,255,255,0.04)">Reset</button>
          <div style="margin-left:auto" class="muted-block">Available Balance: <strong id="balanceDisplay">—</strong></div>
        </div>
      </form>

      <div class="note">Transfers are processed instantly for internal accounts and may take 1–3 business days for external accounts.</div>
    </div>

    <div class="panel balance-card">
      <div>
        <div class="balance-label">Current Balance</div>
        <div class="balance-amount" id="balanceAmount">—</div>
        <div class="muted-block" id="currencyLabel">Currency: —</div>
      </div>

      <div style="margin-top:18px">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <div class="subtitle">Recent Transactions</div>
          <div class="muted-block">Showing debits</div>
        </div>

        <div class="history-list" id="historyList" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <script>
    // Configuration: storage keys
    const BALANCE_KEY = 'balance'; // { amount: number, currency: string }
    const TX_KEY = 'transactions'; // array of tx objects

    // Utility: format currency with basic fallback
    function formatAmount(amount, currency) {
      try {
        return new Intl.NumberFormat(undefined, { style: 'currency', currency }).format(amount);
      } catch (e) {
        return (currency ? currency + ' ' : '') + Number(amount).toFixed(2);
      }
    }

    // Initialize demo data if none exists (safe default)
    function initData() {
      const b = localStorage.getItem(BALANCE_KEY);
      if (!b) {
        const initial = { amount: 5000.00, currency: 'USD' };
        localStorage.setItem(BALANCE_KEY, JSON.stringify(initial));
      }
      const t = localStorage.getItem(TX_KEY);
      if (!t) {
        localStorage.setItem(TX_KEY, JSON.stringify([]));
      }
    }

    function readBalance() {
      try {
        return JSON.parse(localStorage.getItem(BALANCE_KEY)) || { amount:0, currency:'USD' };
      } catch { return { amount:0, currency:'USD' }; }
    }
    function writeBalance(b) {
      localStorage.setItem(BALANCE_KEY, JSON.stringify(b));
    }

    function readTxs() {
      try {
        return JSON.parse(localStorage.getItem(TX_KEY)) || [];
      } catch { return []; }
    }
    function writeTxs(txs) {
      localStorage.setItem(TX_KEY, JSON.stringify(txs));
    }

    // Render UI
    function renderBalance() {
      const b = readBalance();
      document.getElementById('balanceAmount').textContent = formatAmount(b.amount, b.currency);
      document.getElementById('balanceDisplay').textContent = formatAmount(b.amount, b.currency);
      document.getElementById('currencyLabel').textContent = 'Currency: ' + (b.currency || '—');
      // account id placeholder
      document.getElementById('accountId').textContent = 'ACCT-001';
    }

    function renderHistory() {
      const list = document.getElementById('historyList');
      list.innerHTML = '';
      const txs = readTxs().slice().reverse(); // newest first
      if (!txs.length) {
        const row = document.createElement('div');
        row.className = 'tx';
        row.innerHTML = '<div class="left"><div class="title">No transactions</div><div class="meta">Your recent debits will appear here</div></div><div class="amount muted">—</div>';
        list.appendChild(row);
        return;
      }
      txs.forEach(tx => {
        // Only show debits for compactness (you can show all types)
        if (typeof tx.amount === 'number' && tx.type === 'debit') {
          const row = document.createElement('div');
          row.className = 'tx';
          row.innerHTML =
            `<div class="left">
              <div class="title">${escapeHtml(tx.description || 'Transfer')}</div>
              <div class="meta">${new Date(tx.timestamp).toLocaleString()} · To ${escapeHtml(tx.toAccount)} · ${escapeHtml(tx.currency)}</div>
             </div>
             <div class="amount" style="color:${tx.success ? 'var(--success)' : 'var(--danger)'}">${tx.success ? '-' : ''}${formatAmount(tx.amount, tx.currency)}</div>`;
          list.appendChild(row);
        }
      });
    }

    // sanitation for simple text
    function escapeHtml(s) {
      if (!s && s !== 0) return '';
      return String(s).replace(/[&<>"']/g, function(m) { return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'})[m]; });
    }

    // Receipt print: open new window with printable content
    function printReceipt(tx) {
      // Build a minimal printable HTML
      const win = window.open('', '_blank', 'noopener,noreferrer');
      if (!win) {
        alert('Please allow popups to enable printing the receipt.');
        return;
      }
      const html = `
        <!doctype html>
        <html>
        <head>
          <meta charset="utf-8" />
          <title>Receipt - Transfer</title>
          <style>
            body{font-family:Inter,Arial,Helvetica,sans-serif;color:#111;background:#fff;padding:28px;}
            .wrap{max-width:680px;margin:0 auto;border:1px solid #eee;padding:24px;border-radius:8px;}
            h1{margin:0 0 6px;font-size:20px;}
            p{margin:6px 0;color:#333}
            .meta{margin-top:12px;padding:12px;background:#f7f7fb;border-radius:8px}
            .amount{font-size:22px;font-weight:800;margin-top:12px}
            .small{font-size:12px;color:#666}
            .pair{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #eee}
            .pair:last-child{border-bottom:0}
          </style>
        </head>
        <body>
          <div class="wrap" id="printable">
            <h1>Transaction Receipt</h1>
            <p class="small">Transaction ID: ${escapeHtml(tx.id)}</p>
            <div class="meta">
              <div class="pair"><div><strong>Type</strong></div><div>${escapeHtml(tx.kind)}</div></div>
              <div class="pair"><div><strong>To</strong></div><div>${escapeHtml(tx.toAccount)}</div></div>
              <div class="pair"><div><strong>Amount</strong></div><div class="amount">${formatAmount(tx.amount, tx.currency)}</div></div>
              <div class="pair"><div><strong>Currency</strong></div><div>${escapeHtml(tx.currency)}</div></div>
              <div class="pair"><div><strong>Reference</strong></div><div>${escapeHtml(tx.description || '—')}</div></div>
              <div class="pair"><div><strong>Date</strong></div><div>${new Date(tx.timestamp).toLocaleString()}</div></div>
              <div class="pair"><div><strong>Status</strong></div><div>${tx.success ? 'Completed' : 'Failed'}</div></div>
            </div>
            <p class="small" style="margin-top:16px">This receipt documents the transfer. Keep it for your records.</p>
          </div>
          <script>window.print(); setTimeout(()=>window.close(), 750);</script>
        </body>
        </html>
      `;
      win.document.open();
      win.document.write(html);
      win.document.close();
    }

    // Create unique tx id
    function makeTxId() {
      return 'tx_' + Date.now().toString(36) + '_' + Math.random().toString(36).slice(2,8);
    }

    // Main transfer handler
    document.getElementById('transferForm').addEventListener('submit', function(e){
      e.preventDefault();
      const toAccount = (document.getElementById('toAccount').value || '').trim();
      const amountRaw = parseFloat(document.getElementById('amount').value);
      const currency = document.getElementById('currency').value || readBalance().currency || 'USD';
      const type = document.getElementById('type').value || 'internal';
      const note = document.getElementById('note').value || '';

      if (!toAccount) { alert('Please enter a recipient account number.'); return; }
      if (!amountRaw || isNaN(amountRaw) || amountRaw <= 0) { alert('Enter a valid amount greater than 0.'); return; }

      const balance = readBalance();

      // Currency naive check: if currencies differ, reject (simple approach)
      if (currency !== balance.currency) {
        if (!confirm('Transfer currency differs from your account currency. Proceed and allow conversion?')) return;
      }

      // Check funds
      if (amountRaw > balance.amount) {
        alert('Insufficient funds. Please reduce the transfer amount.');
        return;
      }

      // Prepare transaction
      const tx = {
        id: makeTxId(),
        timestamp: Date.now(),
        toAccount: toAccount,
        amount: Number(amountRaw),
        currency: currency,
        type: type,
        kind: 'Transfer',
        description: note,
        success: true // in a real app, success depends on server response
      };

      // Persist: deduct balance, record tx
      const newBalance = Object.assign({}, balance, { amount: Number((balance.amount - amountRaw).toFixed(2)) });
      writeBalance(newBalance);

      const txs = readTxs();
      txs.push(Object.assign({}, tx, { direction: 'outbound', status: 'completed', type: 'debit' }));
      writeTxs(txs);

      // Update UI immediately
      renderBalance();
      renderHistory();

      // Print receipt
      printReceipt(tx);

      // Small success feedback
      alert('Transfer successful. A receipt will be printed.');

      // Reset form
      document.getElementById('transferForm').reset();
      document.getElementById('currency').value = newBalance.currency;
    });

    document.getElementById('resetBtn').addEventListener('click', function(){
      if (confirm('Reset the transfer form?')) {
        document.getElementById('transferForm').reset();
      }
    });

    // Initialize on load
    (function init(){
      initData();
      // Set default currency to current balance currency
      const balance = readBalance();
      const currencySelect = document.getElementById('currency');
      currencySelect.value = balance.currency || 'USD';
      renderBalance();
      renderHistory();
    })();
  </script>
</body>
</html>

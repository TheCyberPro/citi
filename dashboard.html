<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>CITI — Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Inter -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#0b1220; --panel:#07101a; --card:#0f1724;
      --muted:#98A0AD; --text:#E9F2FF; --accent:#9C7CFF; --accent-2:#00D4FF;
      --success:#7CFFCC; --danger:#FF7A7A;
      --radius:12px; --container:1180px; --gap:16px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(600px 380px at 10% 10%, rgba(156,124,255,0.06), transparent 6%),
        radial-gradient(500px 300px at 90% 85%, rgba(0,212,255,0.03), transparent 8%),
        var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
      letter-spacing:-0.01em;
      padding-bottom:100px;
    }
    .container{max-width:var(--container);margin:0 auto;padding:0 20px}

    /* Header: top row and sub row */
    header.site-header{position:sticky;top:0;z-index:1200;padding-top:8px}
    .header-top{display:flex;align-items:center;justify-content:space-between;padding:10px 0;background:linear-gradient(180deg, rgba(6,10,18,0.6), rgba(6,10,18,0.45));border-bottom:1px solid rgba(255,255,255,0.02);backdrop-filter:blur(6px)}
    .nav-toggle{width:44px;height:44px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);display:grid;place-items:center;background:transparent;cursor:pointer}
    .nav-toggle span{display:block;width:18px;height:2px;background:var(--muted);border-radius:2px}
    .header-right .logo img{height:36px}

    .header-sub{display:flex;align-items:center;padding:10px 0}
    .secure-inline{display:flex;gap:12px;align-items:center}
    .secure-line{font-size:0.95rem;color:var(--muted)}
    .member-line{font-size:0.88rem;color:var(--muted)}

    /* Overlay (kept simple) */
    .menu-overlay{display:none;position:fixed;inset:0;z-index:1500}
    .overlay-panel{position:relative;max-width:360px;height:100%;right:0;background:var(--card);padding:18px;border-left:1px solid rgba(255,255,255,0.02)}

    /* Secure banner */
    .secure-banner{margin:16px auto;display:flex;align-items:center;gap:12px;padding:10px 20px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02);color:var(--muted);font-size:0.95rem}

    /* Layout */
    main.dashboard{padding:18px 0}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:20px;align-items:start}

    /* Panel */
    .panel{padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.03)}
    .dashboard__title{font-size:1.5rem;margin:12px 0 18px;font-weight:600}

    /* User */
    .user-profile{display:flex;gap:12px;align-items:center}
    .avatar{width:56px;height:56px;border-radius:50%;object-fit:cover;border:1px solid rgba(255,255,255,0.04)}
    .greeting{font-size:1rem;color:var(--muted)}
    .last-login{font-size:0.9rem;color:var(--muted)}

    /* Balances */
    .balances{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin:14px 0}
    .balance-card{padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02)}
    .balance-card h3{font-size:0.95rem;color:var(--muted);margin-bottom:8px}
    .balance-amount{font-size:1.45rem;font-weight:700}

    /* Primary actions (centered) */
    .primary-actions{margin:20px 0}
    .actions-wrap{display:flex;flex-direction:column;align-items:center;gap:14px}
    .secondary-actions{display:flex;gap:12px}
    .btn-ghost.action-small{display:flex;flex-direction:column;align-items:center;padding:8px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);cursor:pointer}
    .icon-sm{width:18px;height:18px;margin-bottom:6px}
    .label-sm{font-size:0.82rem;color:var(--muted)}
    .primary-pair{display:flex;align-items:center;gap:18px;justify-content:center;flex-wrap:wrap}
    .btn-primary-large{display:flex;flex-direction:column;align-items:center;justify-content:center;min-width:160px;padding:18px;border-radius:14px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#07101a;font-weight:700;font-size:1rem;cursor:pointer;box-shadow:0 18px 40px rgba(12,12,40,0.45);transition:transform .12s}
    .btn-primary-large.alt{background:linear-gradient(90deg,var(--accent-2),var(--accent))}
    .btn-primary-large:active{transform:translateY(1px)}
    .icon-large{width:28px;height:28px;margin-bottom:8px}
    .label-large{font-size:1rem}
    .primary-spacer{width:18px}

    /* Transactions: table and cards */
    .transactions-section { margin-top:18px; }
    .section-header { display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px; }
    .section-controls { display:flex;align-items:center;gap:10px; }
    .tx-mini-search { padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);min-width:160px }
    .transactions-table-wrapper { border-radius:12px; overflow:auto; border:1px solid rgba(255,255,255,0.02); background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); }
    table.transactions { width:100%; border-collapse:collapse; min-width:680px; }
    table.transactions thead th { padding:14px 16px; text-align:left; color:var(--muted); font-size:0.9rem; border-bottom:1px solid rgba(255,255,255,0.02); }
    table.transactions tbody td { padding:12px 16px; font-size:0.95rem; border-top:1px solid rgba(255,255,255,0.02); }
    .text-right { text-align:right; }

    .tx-cards { display:none; gap:10px; margin-top:8px; }
    .tx-card { display:flex; justify-content:space-between; align-items:center; padding:12px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.02) }
    .tx-date { font-size:0.9rem; color:var(--muted) }
    .tx-desc { font-weight:600 }

    .amount.negative, .tx-amount.negative { color:var(--danger); font-weight:700 }
    .amount.positive, .tx-amount.positive { color:var(--success); font-weight:700 }

    /* Drawer: luxury shell */
    .transactions-drawer { position:fixed; inset:0; z-index:1800; display:none; }
    .transactions-drawer.open { display:block; }
    .drawer-backdrop { position:absolute; inset:0; background:rgba(2,6,23,0.6); backdrop-filter: blur(6px); }
    .drawer-shell { position:absolute; right:0; top:6vh; bottom:6vh; width:560px; max-width:96%; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-left:1px solid rgba(255,255,255,0.03); border-radius:12px 0 0 12px; box-shadow:-30px 40px 120px rgba(2,6,23,0.7); display:flex; flex-direction:column; overflow:hidden; }
    .drawer-head { display:flex; align-items:flex-start; justify-content:space-between; gap:12px; padding:18px; border-bottom:1px solid rgba(255,255,255,0.02) }
    .drawer-title { margin:0; font-size:1.15rem }
    .drawer-sub { color:var(--muted); font-size:0.85rem; margin-top:4px }
    .search-wrap { position:relative; }
    .tx-search { padding:10px 36px 10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:var(--text); min-width:220px; }
    .btn-icon { position:absolute; right:6px; top:50%; transform:translateY(-50%); background:none; border:none; color:var(--muted); cursor:pointer; padding:6px; }
    .filters { display:flex; gap:8px; align-items:center; margin-left:8px }
    .date-input { padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:var(--text) }
    .drawer-body { padding:12px 16px 18px; display:flex; flex-direction:column; gap:12px; flex:1; overflow:hidden }
    .drawer-table-wrap { overflow:auto; border-radius:8px; border:1px solid rgba(255,255,255,0.02); }
    .drawer-table { width:100%; border-collapse:collapse; min-width:480px; }
    .drawer-table thead th { padding:12px 14px; text-align:left; color:var(--muted); font-size:0.9rem; border-bottom:1px solid rgba(255,255,255,0.02) }
    .drawer-table tbody td { padding:12px 14px; border-top:1px solid rgba(255,255,255,0.02); font-size:0.95rem }
    .drawer-footer { display:flex; align-items:center; justify-content:space-between; gap:12px; padding-top:8px; border-top:1px solid rgba(255,255,255,0.02) }
    .pager { display:flex; align-items:center; gap:8px }
    .pager-btn { padding:8px 10px; border-radius:8px; background:transparent; border:1px solid rgba(255,255,255,0.03); color:var(--text); cursor:pointer }
    .pager-info { font-size:0.95rem; color:var(--muted) }

    /* Settings */
    .settings-section{margin-top:18px}
    .settings-form{display:grid;gap:10px;max-width:520px}
    .settings-form input{padding:10px;border:1px solid rgba(255,255,255,0.04);border-radius:8px;background:transparent;color:var(--text)}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;color:#07101a;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:700}
    .security-note{font-size:0.9rem;color:var(--muted);margin-top:8px}

    /* Footer */
    footer.site-footer{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(180deg, rgba(2,6,23,0.95), rgba(2,6,23,0.98));border-top:1px solid rgba(255,255,255,0.02);padding:14px 20px;display:flex;justify-content:center}
    .footer-inner{max-width:var(--container);width:100%;display:flex;align-items:center;justify-content:space-between;gap:12px;color:var(--muted);font-size:0.95rem}
    .trust-badge{width:44px;height:44px;border-radius:50%;display:grid;place-items:center;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.03);color:var(--accent);margin-right:12px}
    .footer-meta{display:flex;flex-direction:column;font-size:0.92rem}
    .footer-sub{font-size:0.82rem;color:var(--muted);margin-top:4px}
    .footer-links a{color:var(--muted);text-decoration:none;margin-left:18px;font-weight:500}

    /* Responsive */
    @media (max-width:1100px){
      .grid{grid-template-columns:1fr}
      .tx-cards{display:block}
      .transactions-table-wrapper{display:none}
      .transactions-drawer{width:100%}
    }
    @media (max-width:720px){
      .primary-pair{flex-direction:column}
      .btn-primary-large{min-width:220px;width:86%}
      .secondary-actions{order:2;margin-top:6px}
      .avatar{width:48px;height:48px}
      .container{padding:0 16px}
    }

    button:focus, a:focus{outline:2px solid rgba(156,124,255,0.14);outline-offset:2px}
/* Component tokens (match your luxury theme) */
:root{
  --cg-width: 420px;
  --cg-radius: 16px;
  --cg-bg1: #071833;
  --cg-bg2: #0b2a4b;
  --cg-glass: rgba(255,255,255,0.04);
  --cg-muted: rgba(255,255,255,0.85);
  --cg-accent: rgba(156,124,255,0.12);
  --cg-shadow: 0 22px 60px rgba(2,6,23,0.7);
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

/* Layout */
.card-generator{display:flex;gap:22px;align-items:flex-start;flex-wrap:wrap}
.card-controls{min-width:260px;max-width:360px;display:flex;flex-direction:column;gap:10px}
.card-controls label{display:flex;flex-direction:column;font-size:0.9rem;color:var(--cg-muted)}
.card-controls input[type="text"], .card-controls input[type="month"], .card-controls input[type="search"]{
  margin-top:8px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--cg-muted);
}
.controls-row{display:flex;gap:10px;margin-top:6px}
.btn-primary{background:linear-gradient(90deg,#9C7CFF,#00D4FF);color:#07101a;padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--cg-muted);padding:10px 12px;border-radius:10px;cursor:pointer}

/* card preview wrap */
.card-preview-wrap{flex:1;display:flex;align-items:center;justify-content:center;min-width:var(--cg-width)}
.cg-card{
  width:var(--cg-width);max-width:92%;border-radius:var(--cg-radius);padding:22px;background:
  radial-gradient(600px 200px at -10% -10%, rgba(156,124,255,0.06), transparent 10%),
  linear-gradient(135deg, var(--cg-bg1), var(--cg-bg2));
  color:#fff;position:relative;box-shadow:var(--cg-shadow);border:1px solid rgba(255,255,255,0.04);overflow:hidden;
}

/* subtle texture */
.cg-card::before{content:'';position:absolute;inset:0;background-image:linear-gradient(90deg, rgba(255,255,255,0.01) 1px, transparent 1px);background-size:20px 20px;mix-blend-mode:overlay;opacity:0.06;pointer-events:none}

/* Badge */
.cg-badge{position:absolute;left:18px;top:14px;background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));padding:6px 10px;border-radius:8px;font-weight:600;font-size:12px;color:#fff;border:1px solid rgba(255,255,255,0.04);box-shadow:0 8px 24px rgba(0,0,0,0.35)}

/* top row */
.cg-top{display:flex;justify-content:space-between;align-items:center}
.cg-chip{width:46px;height:34px;border-radius:4px;background:linear-gradient(180deg,#d9caa8,#b89f6b);box-shadow:inset 0 1px 0 rgba(255,255,255,0.4);border:1px solid rgba(0,0,0,0.18)}
.cg-contactless{opacity:0.9;font-weight:600;font-size:10px}
.cg-issuer{font-weight:700;letter-spacing:0.06em;color:#fff;font-size:20px}

/* number */
.cg-number{display:flex;justify-content:space-between;gap:12px;margin:28px 0 18px;font-size:20px;letter-spacing:2px;font-weight:600}
.cg-number .g-n{min-width:56px;text-align:center}
.cg-number .g-last{background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));padding:2px 6px;border-radius:6px}

/* bottom */
.cg-bottom{display:flex;justify-content:space-between;align-items:end;gap:12px}
.cg-label{font-size:10px;color:var(--cg-muted);text-transform:uppercase;letter-spacing:0.06em}
.cg-name{font-weight:700;letter-spacing:0.02em}
.cg-dates{font-weight:600;color:#fff}
.cg-brand{margin-top:6px}

/* responsiveness */
@media (max-width:880px){
  .card-generator{flex-direction:column;align-items:stretch}
  .card-preview-wrap{order: -1;padding-top:6px}
  .card-controls{max-width:100%}
}
/* Account Settings advanced layout */
.settings-wrap { margin-top:20px; margin-bottom:36px; }
.settings-grid { display:grid; grid-template-columns: 1fr 360px; gap:20px; align-items:start; }

/* Panels */
.panel { padding:18px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.03); box-shadow: 0 18px 50px rgba(2,6,23,0.6); }
.side-panel { display:flex; flex-direction:column; gap:14px; }

/* Form */
.settings-form { display:flex; flex-direction:column; gap:12px; max-width:640px; }
.field { display:flex; flex-direction:column; gap:6px; }
.field label { font-weight:600; font-size:0.95rem; }
.field input { padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:var(--text); }
.field-help { font-size:0.85rem; color:var(--muted); }

/* Buttons */
.form-row { display:flex; align-items:center; gap:12px; margin-top:6px; }
.btn-primary { background:linear-gradient(90deg,var(--accent),var(--accent-2)); border:none; color:#07101a; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700; }
.btn-primary-compact { background:linear-gradient(90deg,var(--accent),var(--accent-2)); border:none; color:#07101a; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700; font-size:0.95rem; }
.btn-ghost-compact { background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--text); padding:8px 10px; border-radius:8px; cursor:pointer; }

/* Status */
.settings-status { font-size:0.95rem; color:var(--muted); }

/* Mini cards */
.mini-card { padding:14px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.03); }
.mini-head { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
.mini-title { font-weight:700; }
.mini-sub { font-size:0.88rem; color:var(--muted); }

/* Cards list */
.card-list { display:flex; flex-direction:column; gap:10px; }
.card-item { display:flex; justify-content:space-between; align-items:center; padding:10px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.02); }
.card-name { font-weight:700; }
.card-pan { color:var(--muted); }
.card-balance { font-weight:700; }

/* Quick actions */
.quick-actions { display:flex; flex-direction:column; gap:8px; }
.quick-link { display:block; padding:10px; border-radius:8px; text-decoration:none; color:var(--text); background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.02); }

/* 2FA */
.twofa-body { display:flex; flex-direction:column; gap:8px; }
.twofa-ctas { display:flex; gap:8px; margin-top:6px; }

/* Footer advanced */
.site-footer-adv { position:relative; background:linear-gradient(180deg, rgba(2,6,23,0.95), rgba(2,6,23,0.98)); border-top:1px solid rgba(255,255,255,0.02); padding:16px 0; margin-top:32px; }
.footer-inner { display:flex; align-items:center; justify-content:space-between; gap:12px; color:var(--muted); }
.trust-row { display:flex; align-items:center; gap:12px; }
.trust-badge { width:44px; height:44px; border-radius:50%; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); display:grid; place-items:center; color:var(--accent); border:1px solid rgba(255,255,255,0.03); }
.footer-links a { color:var(--muted); text-decoration:none; margin-left:16px; }

/* Small devices */
@media (max-width: 980px) {
  .settings-grid { grid-template-columns: 1fr; }
  .side-panel { order: 2; }
}
/* container: set radius and clip children */
.cg-card {
  border-radius: 18px;
  overflow: hidden;              /* required to clip the image to the radius */
  display: block;
  width: clamp(260px, 46vw, 420px);
  aspect-ratio: 1.585 / 1;
  box-shadow: 0 20px 50px rgba(2,6,23,0.65), inset 0 1px 0 rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.04);
}

/* image: fill the container without adding its own radius */
.cg-art {
  width: 100%;
  height: 100%;
  display: block;
  object-fit: cover;
  border-radius: 0;              /* do not add radius here; container handles it */
}
.cg-art { border-radius: 18px; display:block; width:100%; height:100%; object-fit:cover; }


  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header" role="banner">
    <div class="container header-top">
      <button id="nav-toggle" class="nav-toggle" aria-label="Open menu"><span aria-hidden="true"></span></button>
      <div class="header-right">
        <a class="logo" href="index.html" aria-label="CITI Home"><img src="assets/citi_logo.png" alt="CITI Logo" /></a>
      </div>
    </div>

    <!-- overlay panel -->
    <div class="menu-overlay" id="menu-overlay" aria-hidden="true">
      <div id="overlay-backdrop" style="position:absolute;inset:0;background:rgba(2,6,23,0.6)"></div>
      <div class="overlay-panel" role="dialog" aria-modal="true">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px">
          <a href="index.html"><img src="assets/citi_logo.png" alt="CITI Logo" style="height:28px"/></a>
          <button class="overlay-close" id="overlay-close" aria-label="Close" style="background:none;border:none;color:var(--muted);font-size:22px">&times;</button>
        </div>

        <ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:12px">
          <li><a href="index.html#products" style="color:var(--text);text-decoration:none">Commercial Banking</a></li>
          <li><a href="index.html#solutions" style="color:var(--text);text-decoration:none">Offshore Banking</a></li>
          <li><a href="index.html#resources" style="color:var(--text);text-decoration:none">Mortgage Banking</a></li>
          <li><a href="index.html#about" style="color:var(--text);text-decoration:none">About</a></li>
          <li><a href="index.html#contact" style="color:var(--text);text-decoration:none">Contact</a></li>
        </ul>

        <div style="margin-top:24px;display:flex;flex-direction:column;gap:10px">
          <a href="login.html" style="padding:10px;border-radius:8px;text-align:center;border:1px solid rgba(255,255,255,0.03);color:var(--text);text-decoration:none">Log out</a>
          <a href="signup.html" style="padding:10px;border-radius:8px;text-align:center;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#07101a;text-decoration:none;font-weight:700">Open Account</a>
        </div>
      </div>
    </div>
  </header>

  <!-- optional secure banner -->
  <div class="secure-banner container" role="status" aria-live="polite">
    <svg class="lock-icon" viewBox="0 0 24 24" aria-hidden="true" width="18" height="18"><path d="M12 1a5 5 0 0 0-5 5v4H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2h-1V6a5 5 0 0 0-5-5z" fill="currentColor"/></svg>
    <span>You’re in a secure session — data is encrypted end-to-end.</span>
  </div>

  <main class="dashboard container" role="main">
    <div class="grid">
      <!-- LEFT -->
      <section class="panel" aria-labelledby="account-overview">
        <div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap">
          <div style="flex:1">
            <div class="user-profile">
              <img src="assets/passport1.png" alt="User Avatar" class="avatar" />
              <div style="margin-left:12px">
                <p class="greeting">Hello, <strong>Hart Gijs</strong></p>
                <p class="last-login" id="last-login">Last login: —</p>
              </div>
            </div>

            <h1 id="account-overview" class="dashboard__title">Account Overview</h1>

            <div class="balances" role="list">
              <div class="balance-card" role="listitem"><h3>Checking</h3><p class="balance-amount" id="checking-balance">$62,345.67</p></div>
              <div class="balance-card" role="listitem"><h3>Savings</h3><p class="balance-amount" id="savings-balance">$758,910.11</p></div>
            </div>

            <!-- Primary actions -->
            <section class="primary-actions" aria-label="Primary account actions">



                <div class="primary-pair" role="group" aria-label="Primary transfers">
                  <button class="btn-primary-large" id="act-withdraw" aria-label="Withdraw">
                    <img src="assets/withdraw.svg" alt="" class="icon-large" />
                    <span class="label-large">Withdraw</span>
                  </button>

                  <div class="primary-spacer" aria-hidden="true"></div>

                  <button class="btn-primary-large alt" id="act-transfer" aria-label="Transfer">
                    <img src="assets/transfer.png" alt="" class="icon-large" />
                    <span class="label-large">Transfer</span>
                  </button>
                </div>
              </div>
            </section>

            <!-- TRANSACTIONS -->
            <section class="transactions-section container" aria-labelledby="recent-tx">
              <div class="section-header">
                <h2 id="recent-tx">Recent Transactions</h2>
                <div class="section-controls">
                  <input id="tx-mini-search" class="tx-mini-search" type="search" placeholder="Search recent" aria-label="Search recent transactions" />
                  <button id="tx-toggle" class="btn-secondary" aria-expanded="false">View All</button>
                </div>
              </div>

              <div class="transactions-table-wrapper" aria-hidden="false">
                <table class="transactions" role="table" aria-label="Recent transactions">
                  <thead>
                    <tr>
                      <th scope="col">Date</th>
                      <th scope="col">Description</th>
                      <th scope="col" class="text-right">Amount</th>
                      <th scope="col" class="text-right">Balance</th>
                    </tr>
                  </thead>
                  <tbody id="tx-tbody">
                    <tr>
                      <td>Oct 4, 2025 • 11:44 PM</td>
                      <td>Debit</td>
                      <td class="amount negative text-right">−$500.00</td>
                      <td class="text-right">$64,345.67</td>
                   </tr>
                    <tr>
                      <td>Sep 30, 2025 • 09:12 AM</td>
                      <td>Credit</td>
                      <td class="amount positive text-right">+$2,000.00</td>
                      <td class="text-right">$62,345.67</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="tx-cards" id="tx-cards" aria-hidden="true"></div>

              <!-- All Transactions Drawer (luxury) -->
              <aside class="transactions-drawer" id="tx-drawer" aria-hidden="true" role="dialog" aria-label="All transactions">
                <div class="drawer-backdrop" id="tx-backdrop" tabindex="-1"></div>

                <div class="drawer-shell" role="document" aria-modal="true">
                  <header class="drawer-head">
                    <div>
                      <h3 class="drawer-title">All Transactions</h3>
                      <div class="drawer-sub muted">Search, filter, and export your full history</div>
                    </div>

                    <div class="drawer-actions">
                      <div class="search-wrap">
                        <input id="tx-search" class="tx-search" type="search" placeholder="Search description, amount or date" aria-label="Search transactions" />
                        <button id="tx-clear-search" class="btn-icon" title="Clear search" aria-label="Clear search">✕</button>
                      </div>

                      <div class="filters">
                        <select id="tx-filter-type" aria-label="Filter by type">
                          <option value="all">All</option>
                          <option value="credit">Credit</option>
                          <option value="debit">Debit</option>
                          <option value="pending">Pending</option>
                        </select>

                        <input id="tx-date-from" type="date" class="date-input" aria-label="Date from" />
                        <input id="tx-date-to" type="date" class="date-input" aria-label="Date to" />
                      </div>

                      <div class="drawer-ctas">
                        <button id="tx-export" class="btn-ghost" aria-label="Export transactions">Export</button>
                        <button id="drawer-close" class="btn-close" aria-label="Close transactions">&times;</button>
                      </div>
                    </div>
                  </header>

                  <div class="drawer-body" id="tx-drawer-body">
                    <div class="drawer-table-wrap">
                      <table class="drawer-table" id="drawer-table" role="table" aria-label="Transaction history">
                        <thead>
                          <tr><th>Date</th><th>Description</th><th class="text-right">Amount</th><th class="text-right">Balance</th></tr>
                        </thead>
                        <tbody id="drawer-tbody"><!-- injected --></tbody>
                      </table>
                    </div>

                    <div class="drawer-footer">
                      <div class="pager">
                        <button id="tx-prev" class="pager-btn" aria-label="Previous page">‹</button>
                        <div class="pager-info"><span id="tx-page">1</span> / <span id="tx-pages">1</span></div>
                        <button id="tx-next" class="pager-btn" aria-label="Next page">›</button>
                      </div>
                      <div class="drawer-note muted">Showing <span id="tx-count">0</span> transactions</div>
                    </div>
                  </div>
                </div>
              </aside>
            </section>
<figure id="cg-card" class="cg-card" role="img" aria-label="Credit card preview">
  <img
    src="assets/creditcard.png"
    srcset="assets/creditcard.png 1x, assets/creditcard.png 2x"
    alt="Credit card artwork"
    class="cg-art"
    loading="lazy"
    width="840" height="530"
  />
</figure>

<style>
/* Responsive polished card container */
.cg-card {
  width: clamp(260px, 46vw, 420px);
  aspect-ratio: 1.585 / 1;
  border-radius: 18px;
  overflow: hidden;
  position: relative;
  display: block;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.04);
  box-shadow: 0 20px 50px rgba(2,6,23,0.65), inset 0 1px 0 rgba(255,255,255,0.02);
  margin: 0 auto;
}

/* Artwork fills the card */
.cg-art {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  -webkit-user-drag: none;
  user-select: none;
}
</style>


<!-- BEGIN: Advanced Account Settings + Cards + 2FA + Footer (drop-in) -->
<section id="account-settings" class="settings-wrap container" aria-labelledby="settings-title">
  <div class="settings-grid">

    <!-- Settings column -->
    <div class="settings-panel panel" role="region" aria-labelledby="settings-title">
      <h2 id="settings-title">Account Settings</h2>

      <form id="settings-form-advanced" class="settings-form" novalidate>
        <div class="field">
          <label for="settings-email">Email</label>
          <input id="settings-email" name="email" type="email" placeholder="you@example.com" aria-describedby="email-help" />
          <div id="email-help" class="field-help">Primary contact for statements and security alerts</div>
        </div>

        <div class="field">
          <label for="settings-password">New Password</label>
          <input id="settings-password" name="password" type="password" placeholder="••••••••" aria-describedby="pwd-help" />
          <div id="pwd-help" class="field-help">Use at least 12 characters with numbers and symbols</div>
        </div>

        <div class="form-row">
          <button type="submit" class="btn-primary" id="settings-save">Save Changes</button>
          <div id="settings-status" role="status" aria-live="polite" class="settings-status"></div>
        </div>

        <p class="security-note">
          <strong>Security</strong> — CITI uses bank‑grade TLS 1.3 and industry‑standard safeguards; two‑factor authentication is supported.
        </p>
      </form>
    </div>

    <!-- Side column: Cards / Quick actions / 2FA -->
    <aside class="side-panel" role="complementary" aria-labelledby="side-title">
      <h3 id="side-title" class="visually-hidden">Account utilities</h3>

      <!-- Quick actions -->
      <div class="mini-card">
        <div class="mini-head">
          <div class="mini-title">Quick actions</div>
          <div class="mini-sub muted">Shortcuts for common tasks</div>
        </div>

        <div class="quick-actions">
          <a href="#security" class="quick-link">🔒 Security & Privacy</a>
          <a href="#limits" class="quick-link">📊 Transaction limits</a>
          <a href="#banking" class="quick-link">🏦 Bank details</a>
        </div>
      </div>

      <!-- Two Factor Authentication -->
      <div class="mini-card">
        <div class="mini-head">
          <div>
            <div class="mini-title">Two-Factor Authentication</div>
            <div class="mini-sub muted">Protect your account with an extra verification step</div>
          </div>
        </div>

        <div class="twofa-body">
          <p class="muted small">We recommend authenticator apps for highest security or SMS as a fallback.</p>
          <div class="twofa-ctas">
            <button id="enable-2fa-adv" class="btn-primary-compact">Get Started</button>
            <button id="learn-2fa-adv" class="btn-ghost-compact">Learn</button>
          </div>
        </div>
      </div>
    </aside>
  </div>
</section>

<!-- Luxury footer -->
<footer class="site-footer-adv" role="contentinfo">
  <div class="footer-inner container">
    <div class="footer-left">
      <div class="trust-row">
        <div class="trust-badge" aria-hidden="true">🔷</div>
        <div>
          <div class="footer-brand">© <span id="footer-year-adv"></span> CITI - 2025</div>
        </div>
      </div>
    </div>

    <div class="footer-right">
      <nav class="footer-links" aria-label="Footer">
        <a href="/privacy.html">Privacy Terms Support</a>
      </nav>
    </div>
  </div>
</footer>
<!-- END: Advanced drop-in -->

  <!-- Scripts: all logic kept, organized and grouped -->
  <script>
    /* Helpers */
    function fmtAmount(val){
      if (val === 0) return '—';
      const abs = Math.abs(val).toLocaleString(undefined,{minimumFractionDigits:2});
      return (val < 0 ? '−' : '+') + abs;
    }

    function formatLoginTime(date){
      const opts = { month:'short', day:'numeric', year:'numeric', hour:'numeric', minute:'2-digit', hour12:true };
      return new Intl.DateTimeFormat('en-US', opts).format(date).replace(',', '').replace(' ', ' @ ');
    }

    // Source transactions: prefer global transactions array if provided, else extract table rows
    function sourceTransactions(){
      if (window.transactions && Array.isArray(window.transactions)) return window.transactions.slice();
      const rows = Array.from(document.querySelectorAll('table.transactions tbody tr'));
      if (!rows.length) return [];
      return rows.map(r => {
        const td = r.querySelectorAll('td');
        const amountRaw = (td[2]?.textContent || '').trim();
        const amount = parseFloat(amountRaw.replace(/[^0-9\.\-]/g,'')) || 0;
        return {
          date: (td[0]?.textContent || '').trim(),
          desc: (td[1]?.textContent || '').trim(),
          amountRaw,
          amount,
          balance: (td[3]?.textContent || '').trim(),
          time: ''
        };
      });
    }
  </script>
<script>
/* Robust action wiring for act-withdraw and act-transfer */
(function(){
  function safeNavigate(url){
    try { location.assign(url); }
    catch(e){ location.href = url; }
  }

  function attachAction(id, url){
    const el = document.getElementById(id);
    if (!el) {
      console.warn('[Action Wiring] Element not found:', id);
      return;
    }

    // Replace element with a clean clone to remove any stale inline listeners without changing attributes
    const clone = el.cloneNode(true);
    el.parentNode.replaceChild(clone, el);

    // Add a single, reliable click listener
    clone.addEventListener('click', function(evt){
      try {
        // prevent accidental form submit or other default behavior
        if (evt && typeof evt.preventDefault === 'function') evt.preventDefault();
        // small visual feedback
        clone.disabled = true;
        setTimeout(()=> clone.disabled = false, 600);
        console.info(`[Action Wiring] ${id} clicked — navigating to ${url}`);
        safeNavigate(url);
      } catch(err){
        console.error('[Action Wiring] Error on click for', id, err);
      }
    }, {passive:false});
  }

  function ensureAttached(){
    attachAction('act-withdraw', '/withdraw.html');
    attachAction('act-transfer', '/transfer.html');
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', ensureAttached);
  } else {
    ensureAttached();
  }

  // If your app replaces DOM later (client router), keep a fallback: retry attach once after a short delay
  setTimeout(ensureAttached, 1200);

  console.log('Action wiring helper loaded; withdraw/transfer listeners attached or scheduled.');
})();
</script>

  <script>
    // App initialization and wiring
    document.addEventListener('DOMContentLoaded', () => {
      // Footer year
      document.getElementById('year').textContent = new Date().getFullYear();

      // Last login: read and update
      (function(){
        const stored = localStorage.getItem('lastLogin');
        const lastLoginDate = stored ? new Date(stored) : new Date();
        const loginEl = document.getElementById('last-login');
        if (loginEl) loginEl.textContent = 'Last login: ' + formatLoginTime(lastLoginDate);
        try { localStorage.setItem('lastLogin', new Date().toISOString()); } catch(e){}
      })();

      // Transactions rendering functions
      function renderTxTableRows(txs){
        const tbody = document.getElementById('tx-tbody');
        if (!tbody) return;
        tbody.innerHTML = txs.slice(0,3).map(tx => `
          <tr>
            <td>${tx.date}${tx.time ? ' • ' + tx.time : ''}</td>
            <td>${tx.desc}</td>
            <td class="amount ${tx.amount < 0 ? 'negative' : (tx.amount > 0 ? 'positive' : '')} text-right">${tx.amountRaw ?? fmtAmount(tx.amount)}</td>
            <td class="text-right">${tx.balance || ''}</td>
          </tr>
        `).join('');
      }

      function renderTxCards(txs){
        const cards = document.getElementById('tx-cards');
        if (!cards) return;
        cards.innerHTML = (txs.slice(0,6).map(tx => `
          <div class="tx-card" role="article">
            <div>
              <div class="tx-date">${tx.date}${tx.time ? ' • ' + tx.time : ''}</div>
              <div class="tx-desc">${tx.desc}</div>
            </div>
            <div style="text-align:right">
              <div class="tx-amount ${tx.amount < 0 ? 'negative' : 'positive'}">${tx.amountRaw ?? fmtAmount(tx.amount)}</div>
              <div class="tx-balance" style="font-size:.8rem;color:var(--muted)">${tx.balance||''}</div>
            </div>
          </div>
        `).join('')) || '<div class="muted">No recent transactions</div>';
      }

      // Drawer advanced controls: filters, pagination, export
      (function drawerModule(){
        const btnViewAll = document.getElementById('tx-toggle');
        const drawer = document.getElementById('tx-drawer');
        const drawerBackdrop = document.getElementById('tx-backdrop');
        const drawerClose = document.getElementById('drawer-close');
        const drawerTbody = document.getElementById('drawer-tbody');

        const txSearch = document.getElementById('tx-search');
        const txClear = document.getElementById('tx-clear-search');
        const filterType = document.getElementById('tx-filter-type');
        const dateFrom = document.getElementById('tx-date-from');
        const dateTo = document.getElementById('tx-date-to');
        const exportBtn = document.getElementById('tx-export');

        let page = 1;
        const pageSize = 10;
        let filtered = [];

        function applyFilters(list){
          const q = (txSearch?.value || '').trim().toLowerCase();
          const type = filterType?.value || 'all';
          const from = dateFrom?.value ? new Date(dateFrom.value) : null;
          const to = dateTo?.value ? new Date(dateTo.value) : null;

          return list.filter(item => {
            if (type !== 'all') {
              if (type === 'credit' && item.amount < 0) return false;
              if (type === 'debit' && item.amount > 0) return false;
              if (type === 'pending' && !(item.status && item.status.toLowerCase().includes('pending'))) return false;
            }
            if (from || to) {
              const parsed = new Date(item.date);
              if (from && parsed < from) return false;
              if (to && parsed > new Date(to.getTime() + 86400000)) return false;
            }
            if (!q) return true;
            return [item.date, item.desc, String(item.amount), item.balance, item.status].join(' ').toLowerCase().includes(q);
          });
        }

        function renderDrawerPage(){
          const list = filtered;
          const pages = Math.max(1, Math.ceil(list.length / pageSize));
          if (page > pages) page = pages;
          const start = (page -1) * pageSize;
          const slice = list.slice(start, start + pageSize);

          document.getElementById('tx-page').textContent = page;
          document.getElementById('tx-pages').textContent = pages;
          document.getElementById('tx-count').textContent = list.length;

          if (!drawerTbody) return;
          drawerTbody.innerHTML = slice.map(tx => `
            <tr>
              <td>${tx.date}${tx.time ? ' • ' + tx.time : ''}</td>
              <td>${tx.desc}</td>
              <td class="text-right ${tx.amount < 0 ? 'amount negative' : 'amount positive'}">${tx.amountRaw ?? (tx.amount < 0 ? '−' : '+') + Math.abs(tx.amount).toLocaleString(undefined,{minimumFractionDigits:2})}</td>
              <td class="text-right">${tx.balance || ''}</td>
            </tr>
          `).join('') || '<tr><td colspan="4" style="padding:18px;color:var(--muted)">No transactions found</td></tr>';
        }

        function refreshFiltered(){
          const src = sourceTransactions();
          filtered = applyFilters(src);
          page = 1;
          renderDrawerPage();
        }

        function openDrawer(){
          refreshFiltered();
          drawer.classList.add('open');
          drawer.setAttribute('aria-hidden','false');
          document.body.style.overflow = 'hidden';
          setTimeout(()=> txSearch?.focus(), 120);
          btnViewAll?.setAttribute('aria-expanded','true');
        }
        function closeDrawer(){
          drawer.classList.remove('open');
          drawer.setAttribute('aria-hidden','true');
          document.body.style.overflow = '';
          btnViewAll?.setAttribute('aria-expanded','false');
          btnViewAll?.focus();
        }

        // Events
        btnViewAll?.addEventListener('click', () => {
          if (drawer.classList.contains('open')) closeDrawer(); else openDrawer();
        });
        drawerClose?.addEventListener('click', closeDrawer);
        drawerBackdrop?.addEventListener('click', closeDrawer);

        // Mini search (filter table rows)
        const txMiniSearch = document.getElementById('tx-mini-search');
        txMiniSearch?.addEventListener('input', (e) => {
          const q = e.target.value.trim().toLowerCase();
          const rows = Array.from(document.querySelectorAll('table.transactions tbody tr'));
          rows.forEach(tr => {
            const txt = tr.textContent.toLowerCase();
            tr.style.display = (!q || txt.includes(q)) ? '' : 'none';
          });
        });

        // Debounced filter input
        let tid;
        function debounce(fn, ms=200){ return (...a)=>{ clearTimeout(tid); tid = setTimeout(()=>fn(...a), ms); }; }
        const onFilterChange = debounce(() => { refreshFiltered(); }, 220);

        txSearch?.addEventListener('input', onFilterChange);
        txClear?.addEventListener('click', ()=> { if (txSearch){ txSearch.value=''; refreshFiltered(); txSearch.focus(); }});
        filterType?.addEventListener('change', onFilterChange);
        dateFrom?.addEventListener('change', onFilterChange);
        dateTo?.addEventListener('change', onFilterChange);

        // Pager
        document.getElementById('tx-prev')?.addEventListener('click', ()=> { if (page>1){ page--; renderDrawerPage(); }});
        document.getElementById('tx-next')?.addEventListener('click', ()=> { const pages = Math.max(1, Math.ceil(filtered.length / pageSize)); if (page<pages){ page++; renderDrawerPage(); }});

        // Export CSV
        exportBtn?.addEventListener('click', ()=>{
          const rows = filtered.map(tx => [tx.date, tx.time||'', tx.desc, tx.amountRaw ?? tx.amount, tx.balance || '']);
          const csv = [['Date','Time','Description','Amount','Balance'], ...rows].map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
          const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a'); a.href = url; a.download = `transactions_${new Date().toISOString().slice(0,10)}.csv`; document.body.appendChild(a); a.click();
          setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 400);
        });

        // Close on Escape
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && drawer?.classList.contains('open')) closeDrawer(); });

        // Expose refreshFiltered for external updates (safe)
        window.refreshTransactionDrawer = refreshFiltered;
      })();

      // Initial render for main table and cards
      const initialTx = sourceTransactions();
      renderTxTableRows(initialTx);
      renderTxCards(initialTx);

      // Drawer list initial render kept to open-time refresh only (not automatic)
      // Settings form submit (basic placeholder)
      const settingsForm = document.getElementById('settings-form');
      if (settingsForm){
        settingsForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const email = settingsForm.querySelector('#email').value;
          alert('Settings saved for ' + (email || 'your account'));
        });
      }

      // Action wiring
      const map = { 'act-deposit':'/deposit.html', 'act-withdraw':'/withdraw.html', 'act-transfer':'/transfer.html';
      Object.keys(map).forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('click', () => { window.location.href = map[id]; });
      });

      // 2FA helper
      const enable2fa = document.getElementById('enable-2fa');
      if (enable2fa) enable2fa.addEventListener('click', () => { alert('Begin 2FA setup flow'); });

      // Overlay menu toggle
      const navBtn = document.getElementById('nav-toggle');
      const menuOverlay = document.getElementById('menu-overlay');
      const overlayClose = document.getElementById('overlay-close');
      const overlayBackdrop = document.getElementById('overlay-backdrop');
      if (navBtn && menuOverlay) {
        navBtn.addEventListener('click', () => { menuOverlay.style.display = 'block'; menuOverlay.setAttribute('aria-hidden','false'); });
      }
      if (overlayClose) overlayClose.addEventListener('click', () => { menuOverlay.style.display = 'none'; menuOverlay.setAttribute('aria-hidden','true'); });
      if (overlayBackdrop) overlayBackdrop.addEventListener('click', () => { menuOverlay.style.display = 'none'; menuOverlay.setAttribute('aria-hidden','true'); });

      // Responsive tx presentation
      function syncTxPresentation(){
        const small = window.matchMedia('(max-width:1100px)').matches;
        document.getElementById('tx-table-wrapper').style.display = small ? 'none' : 'block';
        document.getElementById('tx-cards').style.display = small ? 'block' : 'none';
      }
      window.addEventListener('resize', syncTxPresentation);
      syncTxPresentation();
    });

  </script>

  <script>
    // ---- Data (sample or your real data) ----
    // Preserve your transactions array if present; else fall back to this sample
    window.transactions = window.transactions && Array.isArray(window.transactions) ? window.transactions : [
      { date:'Oct 4, 2025', time:'11:44 PM', desc:'Debit', amount:-500.00, balance:64345.67, status:'Successful' },
      { date:'Sep 30, 2025', time:'09:12 AM', desc:'Credit', amount:2000.00, balance:62345.67, status:'Successful' },
      { date:'Oct 2, 2025', time:'10:12 AM', desc:'Transfer to ACME Inc.', amount:-500.00, balance:61845.67, status:'Successful' },
      { date:'Sep 29, 2025', time:'08:16 PM', desc:'Withdrawal', amount:-2900.00, balance:62345.67, status:'Successful' },
    ];

    // ---- Helpers ----
    function fmtAmount(v){
      if (v === 0) return '—';
      const abs = Math.abs(v).toLocaleString(undefined,{minimumFractionDigits:2});
      return (v < 0 ? '−' : '+') + abs;
    }

    function formatLoginTimeISO(date){
      const opts = { month:'short', day:'numeric', year:'numeric', hour:'numeric', minute:'2-digit', hour12:true };
      return new Intl.DateTimeFormat('en-US', opts).format(date).replace(',', '').replace(' ', ' @ ');
    }

    // ---- Render transactions (table, cards, drawer) ----
    function renderRecentTransactions(){
      const list = Array.isArray(window.transactions) ? window.transactions : [];
      const tbody = document.getElementById('tx-tbody');
      if(!tbody) return;
      tbody.innerHTML = list.slice(0,3).map(tx => `
        <tr>
          <td>${tx.date}${tx.time ? ' • ' + tx.time : ''}</td>
          <td>${tx.desc}</td>
          <td class="amount ${tx.amount < 0 ? 'negative' : 'positive'} text-right">${fmtAmount(tx.amount)}</td>
          <td class="text-right">$${(tx.balance || 0).toLocaleString(undefined,{minimumFractionDigits:2})}</td>
        </tr>
      `).join('');
      // mobile cards
      const cards = document.getElementById('tx-cards');
      if(cards){
        cards.innerHTML = list.slice(0,6).map(tx => `
          <div class="tx-card" role="article">
            <div>
              <div class="tx-date">${tx.date}${tx.time ? ' • ' + tx.time : ''}</div>
              <div class="tx-desc">${tx.desc}</div>
            </div>
            <div style="text-align:right">
              <div class="tx-amount ${tx.amount<0?'negative':'positive'}">${fmtAmount(tx.amount)}</div>
              <div class="tx-balance" style="font-size:.8rem;color:var(--muted)">${tx.balance ? '$' + tx.balance.toLocaleString(undefined,{minimumFractionDigits:2}) : ''}</div>
            </div>
          </div>
        `).join('');
      }
    }

    // ---- Drawer: filtering, pagination, export ----
    (function(){
      let page = 1, pageSize = 8, filtered = [];
      const btnViewAll = document.getElementById('tx-toggle');
      const drawer = document.getElementById('tx-drawer');
      const drawerBackdrop = document.getElementById('tx-backdrop');
      const drawerClose = document.getElementById('drawer-close');
      const drawerTbody = document.getElementById('drawer-tbody');
      const txSearch = document.getElementById('tx-search');
      const txClear = document.getElementById('tx-clear-search');
      const filterType = document.getElementById('tx-filter-type');
      const dateFrom = document.getElementById('tx-date-from');
      const dateTo = document.getElementById('tx-date-to');
      const exportBtn = document.getElementById('tx-export');

      function src(){
        return Array.isArray(window.transactions) ? window.transactions.slice() : [];
      }

      function applyFilters(list){
        const q = (txSearch?.value || '').trim().toLowerCase();
        const type = filterType?.value || 'all';
        const from = dateFrom?.value ? new Date(dateFrom.value) : null;
        const to = dateTo?.value ? new Date(dateTo.value) : null;

        return list.filter(item => {
          if (type !== 'all') {
            if (type === 'credit' && item.amount < 0) return false;
            if (type === 'debit' && item.amount > 0) return false;
            if (type === 'pending' && !(item.status && item.status.toLowerCase().includes('pending'))) return false;
          }
          if (from || to) {
            const parsed = new Date(item.date);
            if (from && parsed < from) return false;
            if (to && parsed > new Date(to.getTime() + 86400000)) return false;
          }
          if (!q) return true;
          return [item.date, item.desc, String(item.amount), item.balance, item.status].join(' ').toLowerCase().includes(q);
        });
      }

      function renderDrawerPage(){
        const list = filtered;
        const pages = Math.max(1, Math.ceil(list.length/pageSize));
        if (page > pages) page = pages;
        const start = (page-1)*pageSize;
        const slice = list.slice(start, start+pageSize);
        document.getElementById('tx-page').textContent = page;
        document.getElementById('tx-pages').textContent = pages;
        document.getElementById('tx-count').textContent = list.length;
        if(!drawerTbody) return;
        drawerTbody.innerHTML = slice.map(tx => `
          <tr>
            <td>${tx.date}${tx.time ? ' • ' + tx.time : ''}</td>
            <td>${tx.desc}</td>
            <td class="text-right ${tx.amount < 0 ? 'amount negative' : 'amount positive'}">${fmtAmount(tx.amount)}</td>
            <td class="text-right">${tx.balance ? '$' + tx.balance.toLocaleString(undefined,{minimumFractionDigits:2}) : ''}</td>
          </tr>
        `).join('') || '<tr><td colspan="4" style="padding:18px;color:var(--muted)">No transactions found</td></tr>';
      }

      function refreshFiltered(){
        filtered = applyFilters(src());
        page = 1;
        renderDrawerPage();
      }

      function openDrawer(){
        refreshFiltered();
        drawer.classList.add('open');
        drawer.setAttribute('aria-hidden','false');
        document.body.style.overflow = 'hidden';
        setTimeout(()=> txSearch?.focus(), 120);
        btnViewAll?.setAttribute('aria-expanded','true');
      }
      function closeDrawer(){
        drawer.classList.remove('open');
        drawer.setAttribute('aria-hidden','true');
        document.body.style.overflow = '';
        btnViewAll?.setAttribute('aria-expanded','false');
        btnViewAll?.focus();
      }

      btnViewAll?.addEventListener('click', ()=> drawer.classList.contains('open') ? closeDrawer() : openDrawer());
      drawerClose?.addEventListener('click', closeDrawer);
      drawerBackdrop?.addEventListener('click', closeDrawer);
      document.addEventListener('keydown', e => { if (e.key === 'Escape' && drawer?.classList.contains('open')) closeDrawer(); });

      // debounce helper
      let tId;
      function debounce(fn,ms=220){ return (...a)=>{ clearTimeout(tId); tId = setTimeout(()=>fn(...a), ms); }; }

      txSearch?.addEventListener('input', debounce(()=> refreshFiltered()));
      txClear?.addEventListener('click', ()=>{ if(txSearch){ txSearch.value=''; refreshFiltered(); txSearch.focus(); }});
      filterType?.addEventListener('change', debounce(()=> refreshFiltered()));
      dateFrom?.addEventListener('change', debounce(()=> refreshFiltered()));
      dateTo?.addEventListener('change', debounce(()=> refreshFiltered()));

      document.getElementById('tx-prev')?.addEventListener('click', ()=>{ if(page>1){ page--; renderDrawerPage(); }});
      document.getElementById('tx-next')?.addEventListener('click', ()=>{ const pages = Math.max(1, Math.ceil(filtered.length/pageSize)); if(page<pages){ page++; renderDrawerPage(); }});

      exportBtn?.addEventListener('click', ()=>{
        const rows = filtered.map(tx => [tx.date, tx.time||'', tx.desc, tx.amount, tx.balance||'']);
        const csv = [['Date','Time','Description','Amount','Balance'], ...rows].map(r => r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
        const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = `transactions_${new Date().toISOString().slice(0,10)}.csv`; document.body.appendChild(a); a.click();
        setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 400);
      });

      // export refreshFiltered function if needed externally:
      window.refreshTxDrawer = refreshFiltered;
    })();

    // ---- Last login: read/write + format (fixes real-time display) ----
    (function(){
      const key = 'lastLogin';
      const stored = localStorage.getItem(key);
      const lastLoginEl = document.getElementById('last-login');
      const now = new Date();
      let dateObj;
      if (stored) {
        const parsed = new Date(stored);
        dateObj = isNaN(parsed.getTime()) ? now : parsed;
      } else {
        dateObj = now;
      }
      if (lastLoginEl) lastLoginEl.textContent = 'Last login: ' + formatLoginTimeISO(dateObj);
      try { localStorage.setItem(key, new Date().toISOString()); } catch(e){}
    })();

    // ---- Utilities toggle for mobile (keeps all content but collapses visually) ----
    (function(){
      const toggle = document.getElementById('utilities-toggle');
      const inner = document.getElementById('utilities-inner');
      if (!toggle || !inner) return;
      toggle.addEventListener('click', ()=> {
        const collapsed = inner.classList.toggle('collapsed');
        toggle.setAttribute('aria-expanded', String(!collapsed));
      });
    })();

    // ---- Wire primary actions and settings form (preserve existing logic) ----
    document.addEventListener('DOMContentLoaded', () => {
      // initial render
      renderRecentTransactions();

      // actions
      document.getElementById('act-deposit')?.addEventListener('click', ()=> location.href='/deposit.html');
      document.getElementById('act-withdraw')?.addEventListener('click', ()=> location.href='/withdraw.html');
      document.getElementById('act-transfer')?.addEventListener('click', ()=> location.href='/transfer.html');
      document.getElementById('act-trade')?.addEventListener('click', ()=> location.href='/trade.html');

      // settings save (non-destructive placeholder)
      const settingsForm = document.getElementById('settings-form');
      if (settingsForm) {
        settingsForm.addEventListener('submit', (e)=> {
          e.preventDefault();
          const btn = settingsForm.querySelector('button[type="submit"]');
          const prev = btn.textContent;
          btn.disabled = true; btn.textContent = 'Saving…';
          setTimeout(()=> { btn.disabled=false; btn.textContent=prev; alert('Settings saved'); }, 700);
        });
      }

      // 2FA CTAs
      document.getElementById('enable-2fa')?.addEventListener('click', ()=> { location.href='/2fa-setup.html'; });
      document.getElementById('learn-2fa')?.addEventListener('click', ()=> { location.href='/2fa-info.html'; });

      // overlay menu wiring (preserve)
      document.getElementById('nav-toggle')?.addEventListener('click', ()=> {
        const el = document.getElementById('menu-overlay');
        if(el) { el.style.display = 'block'; el.setAttribute('aria-hidden','false'); }
      });
      document.getElementById('overlay-close')?.addEventListener('click', ()=> {
        const el = document.getElementById('menu-overlay'); if(el){ el.style.display='none'; el.setAttribute('aria-hidden','true'); }
      });

      // mini search for recent transactions (filters rows)
      document.getElementById('tx-mini-search')?.addEventListener('input', function(e){
        const q = (e.target.value || '').toLowerCase().trim();
        document.querySelectorAll('table.transactions tbody tr').forEach(tr => {
          const txt = tr.textContent.toLowerCase();
          tr.style.display = (!q || txt.includes(q)) ? '' : 'none';
        });
      });
    });
  </script>
<script>
/* Ensure overlay values remain synced when your existing card-generator updates #cg-name-display and #cg-last */
document.addEventListener('DOMContentLoaded', () => {
  // support old IDs in case other code writes to them
  const srcName = document.getElementById('cg-name-display');
  const srcLast = document.getElementById('cg-last');
  // if your previous code updated different IDs, map them here
  function syncOverlay(){
    const targetName = document.querySelector('.cg-name#cg-name-display') || srcName;
    const targetLast = document.querySelector('.cg-last#cg-last') || srcLast;
    // no-op if elements missing
    if (!targetName && !targetLast) return;
    // keep current text (existing scripts still write to these IDs)
  }
  // run once and also expose for external code
  syncOverlay();
  window.updateCardOverlay = syncOverlay;
});
</script>
<script>
/* Transaction processing + printable receipt
   Drop this into transfer.html and withdraw.html before </body>.
*/
(function(){
  // Simple persistent balances store (localStorage-backed)
  const BAL_KEY = 'citi_balances_v1';
  function loadBalances(){
    try { return JSON.parse(localStorage.getItem(BAL_KEY)) || { checking:62345.67, savings:758910.11 }; }
    catch(e){ return { checking:62345.67, savings:758910.11 }; }
  }
  function saveBalances(b){ localStorage.setItem(BAL_KEY, JSON.stringify(b)); }

  // Format helpers
  function fmtCurrency(n){
    if (n === null || n === undefined) return '—';
    return '$' + Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
  }
  function nowISO(){ return new Date().toISOString(); }
  function prettyDate(d){
    const dt = new Date(d);
    return dt.toLocaleString(undefined, {month:'short', day:'numeric', year:'numeric', hour:'numeric', minute:'2-digit', hour12:true});
  }

  // Append transaction to a local history (window.transactions) and try to sync with dashboard table
  function pushTransaction(tx){
    // normalize tx: {id,date,from,to,desc,amount,balance}
    window.transactions = window.transactions || [];
    window.transactions.unshift(tx);
    // try to update dashboard table if present in DOM
    const tbody = document.querySelector('#tx-tbody') || document.querySelector('table.transactions tbody');
    if (tbody){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${prettyDate(tx.date)}</td>
        <td>${tx.desc || tx.to || tx.from}</td>
        <td class="amount ${tx.amount < 0 ? 'negative' : 'positive'} text-right">${fmtCurrency(tx.amount)}</td>
        <td class="text-right">${fmtCurrency(tx.balance)}</td>
      `;
      // insert at top
      if (tbody.firstChild) tbody.insertBefore(tr, tbody.firstChild);
      else tbody.appendChild(tr);
      // keep only recent N rows in view (optional)
      if (tbody.children.length > 50) tbody.removeChild(tbody.lastChild);
    }
  }

  // Printable receipt popup
  function printReceipt(tx){
    const receiptHtml = `
      <!doctype html>
      <html>
      <head>
        <meta charset="utf-8"/>
        <title>Receipt</title>
<script>
/* Commit transaction, update balances, append tx row, print receipt
   Paste before </body> on transfer.html and withdraw.html
*/
(function(){
  const BAL_KEY = 'citi_balances_v2';
  const TX_KEY = 'citi_transactions_v2';

  // Safe parser / formatter
  function loadBalances(){ try { return JSON.parse(localStorage.getItem(BAL_KEY)) || { checking:62345.67, savings:758910.11 }; } catch(e){ return { checking:62345.67, savings:758910.11 }; } }
  function saveBalances(b){ localStorage.setItem(BAL_KEY, JSON.stringify(b)); }
  function loadTxs(){ try { return JSON.parse(localStorage.getItem(TX_KEY)) || []; } catch(e){ return []; } }
  function saveTxs(txs){ localStorage.setItem(TX_KEY, JSON.stringify(txs)); }

  function fmtCurrency(n){
    if (n === null || n === undefined) return '—';
    return '$' + Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
  }
  function prettyDateISO(d){
    const dt = new Date(d);
    return dt.toLocaleString(undefined, {month:'short', day:'numeric', year:'numeric', hour:'numeric', minute:'2-digit', hour12:true});
  }

  // DOM helpers
  function appendTxToDom(tx){
    // try tx table tbody first (#tx-tbody)
    const tbody = document.querySelector('#tx-tbody') || document.querySelector('table.transactions tbody');
    if (!tbody) return;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${prettyDateISO(tx.date)}</td>
      <td>${tx.desc || tx.to || tx.from}</td>
      <td class="text-right ${tx.amount < 0 ? 'negative' : 'positive'}">${fmtCurrency(tx.amount)}</td>
      <td class="text-right">${fmtCurrency(tx.balance)}</td>
    `;
    // insert at top so newest first
    tbody.insertBefore(tr, tbody.firstChild);
    // keep DOM trimmed (optional)
    if (tbody.children.length > 200) tbody.removeChild(tbody.lastChild);
  }

  // Create and open printable receipt
  function printReceipt(tx){
    const html = `
      <!doctype html><html><head><meta charset="utf-8"><title>Receipt</title>
      <style>
        body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;color:#07101a;padding:20px}
        .rcpt{max-width:520px;margin:0 auto;border:0;padding:0}
        h2{margin:0 0 8px}
        .row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee}
        .total{font-weight:800}
        @media print{@page{margin:12mm}}
      </style>
      </head><body>
      <div class="rcpt">
        <h2>Transaction Receipt</h2>
        <div class="row"><div class="muted">Date</div><div>${prettyDateISO(tx.date)}</div></div>
        <div class="row"><div>From</div><div>${tx.from}</div></div>
        <div class="row"><div>To</div><div>${tx.to || tx.desc || '—'}</div></div>
        <div class="row"><div>Amount</div><div class="total">${fmtCurrency(tx.amount)}</div></div>
        <div class="row"><div>Balance</div><div>${fmtCurrency(tx.balance)}</div></div>
        <div style="margin-top:12px;color:#666;font-size:12px">Reference: ${tx.id}</div>
      </div>
      <script>window.onload=function(){ setTimeout(()=>{ window.print(); setTimeout(()=>window.close(),600); },120); };</script>
      </body></html>
    `;
    const w = window.open('','_blank','width=520,height=720,scrollbars=yes');
    if (!w) { alert('Popup blocked. Allow popups to print receipt.'); return; }
    w.document.open(); w.document.write(html); w.document.close();
  }

  // Main commit function
  function commitTransaction(opts){
    // opts: {type:'transfer'|'withdraw', from:'checking', to:'recipient', amount:123.45, desc:'...'}
    const balances = loadBalances();
    const txs = loadTxs();
    const from = (opts.from || 'checking').toLowerCase();
    const amount = Number(opts.amount) || 0;
    if (!amount || amount <= 0) throw new Error('Invalid amount');
    if (typeof balances[from] !== 'number') balances[from] = Number(balances[from]) || 0;

    // subtract from source
    balances[from] = Number((balances[from] - amount).toFixed(2));
    saveBalances(balances);

    const tx = {
      id: 'tx_' + Date.now(),
      date: new Date().toISOString(),
      type: opts.type || 'transfer',
      from: from,
      to: opts.to || opts.recipient || '',
      desc: opts.desc || (opts.type === 'withdraw' ? 'Withdrawal' : 'Transfer'),
      amount: -Math.abs(amount),
      balance: balances[from]
    };

    // prepend in-memory and persisted history
    txs.unshift(tx);
    saveTxs(txs);
    // keep window.transactions in sync if other code relies on it
    window.transactions = txs.slice();

    // append to dashboard DOM if present
    appendTxToDom(tx);

    // open receipt
    printReceipt(tx);

    return tx;
  }

  // Hook confirm-send button automatically if present
  function hookConfirmButton(){
    const confirmBtn = document.getElementById('confirm-send');
    if (!confirmBtn) return;
    if (confirmBtn.dataset.citiHook === '1') return;
    confirmBtn.dataset.citiHook = '1';
    confirmBtn.addEventListener('click', (ev) => {
      ev.preventDefault();
      // read the common fields from page
      const fromEl = document.getElementById('from-account');
      const amountEl = document.getElementById('amount');
      const toEl = document.getElementById('to-recipient') || document.getElementById('external-account') || document.querySelector('[name="recipient"]');
      const type = (location.pathname.indexOf('withdraw') !== -1) ? 'withdraw' : 'transfer';
      const from = fromEl ? fromEl.value : 'checking';
      const amount = amountEl ? parseFloat(amountEl.value) : 0;
      const to = toEl ? toEl.value : '';
      if (!amount || amount <= 0) { alert('Enter a valid amount'); return; }

      try {
        confirmBtn.disabled = true;
        confirmBtn.textContent = 'Processing…';
        // commit and then restore UI after short delay
        const tx = commitTransaction({ type, from, to, amount, desc: type === 'withdraw' ? 'Withdrawal' : 'Transfer' });
        setTimeout(() => {
          confirmBtn.disabled = false;
          confirmBtn.textContent = 'Confirm';
          // try to close modal if your modal handler exists
          const backdrop = document.getElementById('confirm-backdrop');
          if (backdrop) backdrop.style.display = 'none';
          // navigate back to dashboard if desired
          if (confirmBtn.dataset.redirect !== 'no') {
            try { location.assign('dashboard.html'); } catch(e){}
          }
        }, 700);
      } catch (err) {
        alert('Transaction failed: ' + (err.message || err));
        confirmBtn.disabled = false;
        confirmBtn.textContent = 'Confirm';
      }
    });
  }

  // If the page uses a different confirm button id (e.g., #confirm-send exists elsewhere), or you want manual commit,
  // call window.commitTransaction({ from:'checking', amount:45, to:'Jane' })
  window.commitTransaction = commitTransaction;

  // Initialize: attempt to hook immediately or on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', hookConfirmButton);
  } else hookConfirmButton();

})();
</script>

</body>
</html>

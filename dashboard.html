<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>CITI â€” Dashboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

<style>
:root{
  --bg:#0b1220; --panel:#07101a; --card:#0f1724;
  --muted:#98A0AD; --text:#E9F2FF; --accent:#9C7CFF; --accent-2:#00D4FF;
  --success:#7CFFCC; --danger:#FF7A7A;
  --radius:12px; --container:1180px; --gap:16px;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

/* Reset + base */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:
    radial-gradient(600px 380px at 10% 10%, rgba(156,124,255,0.06), transparent 6%),
    radial-gradient(500px 300px at 90% 85%, rgba(0,212,255,0.03), transparent 8%),
    var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.45;
  letter-spacing:-0.01em;
  padding-bottom:100px;
}
.container{max-width:var(--container);margin:0 auto;padding:0 20px}

/* Header */
header.site-header{position:sticky;top:0;z-index:1200;padding-top:8px}
.header-top{display:flex;align-items:center;justify-content:space-between;padding:10px 0;background:linear-gradient(180deg, rgba(6,10,18,0.6), rgba(6,10,18,0.45));border-bottom:1px solid rgba(255,255,255,0.02);backdrop-filter:blur(6px)}
.nav-toggle{width:44px;height:44px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);display:grid;place-items:center;background:transparent;cursor:pointer}
.nav-toggle span{display:block;width:18px;height:2px;background:var(--muted);border-radius:2px}
.header-right .logo img{height:36px}
.header-sub{display:flex;align-items:center;padding:10px 0}
.secure-inline{display:flex;gap:12px;align-items:center}
.secure-line{font-size:0.95rem;color:var(--muted)}
.member-line{font-size:0.88rem;color:var(--muted)}

/* Overlay */
.menu-overlay{display:none;position:fixed;inset:0;z-index:1500}
.overlay-panel{position:relative;max-width:360px;height:100%;right:0;background:var(--card);padding:18px;border-left:1px solid rgba(255,255,255,0.02)}

/* Secure banner */
.secure-banner{margin:16px auto;display:flex;align-items:center;gap:12px;padding:10px 20px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02);color:var(--muted);font-size:0.95rem}

/* Layout grid */
main.dashboard{padding:18px 0}
.grid{display:grid;grid-template-columns:1fr 380px;gap:20px;align-items:start}

/* Panels & tokens */
.panel{padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.03)}
.dashboard__title{font-size:1.5rem;margin:12px 0 18px;font-weight:600}

/* Profile */
.user-profile{display:flex;gap:12px;align-items:center}
.avatar{width:56px;height:56px;border-radius:50%;object-fit:cover;border:1px solid rgba(255,255,255,0.04)}
.greeting{font-size:1rem;color:var(--muted)}
.last-login{font-size:0.9rem;color:var(--muted)}

/* Balances */
.balances{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin:14px 0}
.balance-card{padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02)}
.balance-card h3{font-size:0.95rem;color:var(--muted);margin-bottom:8px}
.balance-amount{font-size:1.45rem;font-weight:700}

/* Actions */
.primary-actions{margin:20px 0}
.actions-wrap{display:flex;flex-direction:column;align-items:center;gap:14px}
.primary-pair{display:flex;align-items:center;gap:18px;justify-content:center;flex-wrap:wrap}
.btn-primary-large{display:flex;flex-direction:column;align-items:center;justify-content:center;min-width:160px;padding:18px;border-radius:14px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#07101a;font-weight:700;font-size:1rem;cursor:pointer;box-shadow:0 18px 40px rgba(12,12,40,0.45);transition:transform .12s}
.btn-primary-large.alt{background:linear-gradient(90deg,var(--accent-2),var(--accent))}
.icon-large{width:28px;height:28px;margin-bottom:8px}

/* Transactions (table & cards) */
.transactions-section { margin-top:18px; }
.section-header { display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px; }
.section-controls { display:flex;align-items:center;gap:10px; }
.tx-mini-search { padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);min-width:160px }
.transactions-table-wrapper { border-radius:12px; overflow:auto; border:1px solid rgba(255,255,255,0.02); background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); }
table.transactions { width:100%; border-collapse:collapse; min-width:680px; }
table.transactions thead th { padding:14px 16px; text-align:left; color:var(--muted); font-size:0.9rem; border-bottom:1px solid rgba(255,255,255,0.02); }
table.transactions tbody td { padding:12px 16px; font-size:0.95rem; border-top:1px solid rgba(255,255,255,0.02); }
.text-right { text-align:right; }

.tx-cards { display:none; gap:10px; margin-top:8px; }
.tx-card { display:flex; justify-content:space-between; align-items:center; padding:12px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.02) }
.tx-date { font-size:0.9rem; color:var(--muted) }
.tx-desc { font-weight:600 }

.amount.negative, .tx-amount.negative { color:var(--danger); font-weight:700 }
.amount.positive, .tx-amount.positive { color:var(--success); font-weight:700 }

/* Drawer */
.transactions-drawer { position:fixed; inset:0; z-index:1800; display:none; }
.transactions-drawer.open { display:block; }
.drawer-backdrop { position:absolute; inset:0; background:rgba(2,6,23,0.6); backdrop-filter: blur(6px); }
.drawer-shell { position:absolute; right:0; top:6vh; bottom:6vh; width:560px; max-width:96%; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-left:1px solid rgba(255,255,255,0.03); border-radius:12px 0 0 12px; box-shadow:-30px 40px 120px rgba(2,6,23,0.7); display:flex; flex-direction:column; overflow:hidden; }
.drawer-head { display:flex; align-items:flex-start; justify-content:space-between; gap:12px; padding:18px; border-bottom:1px solid rgba(255,255,255,0.02) }
.drawer-title { margin:0; font-size:1.15rem }
.drawer-sub { color:var(--muted); font-size:0.85rem; margin-top:4px }
.search-wrap { position:relative; }
.tx-search { padding:10px 36px 10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:var(--text); min-width:220px; }
.btn-icon { position:absolute; right:6px; top:50%; transform:translateY(-50%); background:none; border:none; color:var(--muted); cursor:pointer; padding:6px; }
.filters { display:flex; gap:8px; align-items:center; margin-left:8px }
.date-input { padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:var(--text) }
.drawer-body { padding:12px 16px 18px; display:flex; flex-direction:column; gap:12px; flex:1; overflow:hidden }
.drawer-table-wrap { overflow:auto; border-radius:8px; border:1px solid rgba(255,255,255,0.02); }
.drawer-table { width:100%; border-collapse:collapse; min-width:480px; }
.drawer-table thead th { padding:12px 14px; text-align:left; color:var(--muted); font-size:0.9rem; border-bottom:1px solid rgba(255,255,255,0.02) }
.drawer-table tbody td { padding:12px 14px; border-top:1px solid rgba(255,255,255,0.02); font-size:0.95rem }
.drawer-footer { display:flex; align-items:center; justify-content:space-between; gap:12px; padding-top:8px; border-top:1px solid rgba(255,255,255,0.02) }
.pager { display:flex; align-items:center; gap:8px }
.pager-btn { padding:8px 10px; border-radius:8px; background:transparent; border:1px solid rgba(255,255,255,0.03); color:var(--text); cursor:pointer }
.pager-info { font-size:0.95rem; color:var(--muted) }

/* Settings + side */
.settings-wrap { margin-top:20px; margin-bottom:36px; }
.settings-grid { display:grid; grid-template-columns: 1fr 360px; gap:20px; align-items:start; }
.settings-panel .panel{padding:18px}
.settings-form { display:flex; flex-direction:column; gap:12px; max-width:640px; }
.field { display:flex; flex-direction:column; gap:6px; }
.field input { padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:var(--text); }
.field-help { font-size:0.85rem; color:var(--muted); }
.form-row { display:flex; align-items:center; gap:12px; margin-top:6px; }
.btn-primary { background:linear-gradient(90deg,var(--accent),var(--accent-2)); border:none; color:#07101a; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700 }
.mini-card { padding:14px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.03); }
.mini-head { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
.quick-link { display:block; padding:10px; border-radius:8px; text-decoration:none; color:var(--text); background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.02); }

/* Card generator / preview tokens */
:root{
  --cg-width:420px; --cg-radius:16px; --cg-bg1:#071833; --cg-bg2:#0b2a4b; --cg-muted:rgba(255,255,255,0.85);
  --cg-shadow:0 22px 60px rgba(2,6,23,0.7);
}
.cg-card{ width:var(--cg-width); max-width:92%; border-radius:var(--cg-radius); padding:22px; background: radial-gradient(600px 200px at -10% -10%, rgba(156,124,255,0.06), transparent 10%), linear-gradient(135deg, var(--cg-bg1), var(--cg-bg2)); color:#fff; position:relative; box-shadow:var(--cg-shadow); border:1px solid rgba(255,255,255,0.04); overflow:hidden; }
.cg-card::before{content:'';position:absolute;inset:0;background-image:linear-gradient(90deg, rgba(255,255,255,0.01) 1px, transparent 1px);background-size:20px 20px;mix-blend-mode:overlay;opacity:0.06;pointer-events:none}

/* Footer */
.site-footer-adv { position:relative; background:linear-gradient(180deg, rgba(2,6,23,0.95), rgba(2,6,23,0.98)); border-top:1px solid rgba(255,255,255,0.02); padding:16px 0; margin-top:32px; }
.footer-inner { display:flex; align-items:center; justify-content:space-between; gap:12px; color:var(--muted); max-width:var(--container); margin:0 auto; padding:0 20px; }

/* Responsive */
@media (max-width:1100px){
  .grid{grid-template-columns:1fr}
  .tx-cards{display:block}
  .transactions-table-wrapper{display:none}
  .transactions-drawer{width:100%}
}
@media (max-width:720px){
  .primary-pair{flex-direction:column}
  .btn-primary-large{min-width:220px;width:86%}
  .avatar{width:48px;height:48px}
  .container{padding:0 16px}
}

/* Focus outlines */
button:focus, a:focus{outline:2px solid rgba(156,124,255,0.14);outline-offset:2px}
</style>
</head>
<body>
  <!-- Header -->
  <header class="site-header" role="banner">
    <div class="container header-top">
      <button id="nav-toggle" class="nav-toggle" aria-label="Open menu"><span aria-hidden="true"></span></button>
      <div class="header-right">
        <a class="logo" href="index.html" aria-label="CITI Home"><img src="assets/citi_logo.png" alt="CITI Logo" /></a>
      </div>
    </div>

    <!-- overlay panel -->
    <div class="menu-overlay" id="menu-overlay" aria-hidden="true">
      <div id="overlay-backdrop" style="position:absolute;inset:0;background:rgba(2,6,23,0.6)"></div>
      <div class="overlay-panel" role="dialog" aria-modal="true">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px">
          <a href="index.html"><img src="assets/citi_logo.png" alt="CITI Logo" style="height:28px"/></a>
          <button class="overlay-close" id="overlay-close" aria-label="Close" style="background:none;border:none;color:var(--muted);font-size:22px">&times;</button>
        </div>
        <ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:12px">
          <li><a href="index.html#products" style="color:var(--text);text-decoration:none">Commercial Banking</a></li>
          <li><a href="index.html#solutions" style="color:var(--text);text-decoration:none">Offshore Banking</a></li>
          <li><a href="index.html#resources" style="color:var(--text);text-decoration:none">Mortgage Banking</a></li>
          <li><a href="index.html#about" style="color:var(--text);text-decoration:none">About</a></li>
          <li><a href="index.html#contact" style="color:var(--text);text-decoration:none">Contact</a></li>
        </ul>

        <div style="margin-top:24px;display:flex;flex-direction:column;gap:10px">
          <a href="login.html" style="padding:10px;border-radius:8px;text-align:center;border:1px solid rgba(255,255,255,0.03);color:var(--text);text-decoration:none">Log out</a>
          <a href="signup.html" style="padding:10px;border-radius:8px;text-align:center;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#07101a;text-decoration:none;font-weight:700">Open Account</a>
        </div>
      </div>
    </div>
  </header>

  <!-- optional secure banner -->
  <div class="secure-banner container" role="status" aria-live="polite">
    <svg class="lock-icon" viewBox="0 0 24 24" aria-hidden="true" width="18" height="18"><path d="M12 1a5 5 0 0 0-5 5v4H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2h-1V6a5 5 0 0 0-5-5z" fill="currentColor"/></svg>
    <span>Youâ€™re in a secure session â€” data is encrypted end-to-end.</span>
  </div>

  <main class="dashboard container" role="main">
    <div class="grid">
      <!-- LEFT COLUMN -->
      <section class="panel" aria-labelledby="account-overview">
        <div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap">
          <div style="flex:1">
            <div class="user-profile">
              <img src="assets/passport1.png" alt="User Avatar" class="avatar" />
              <div style="margin-left:12px">
                <p class="greeting">Hello, <strong id="greeting-name">Hart Gijs</strong></p>
                <p class="last-login" id="last-login">Last login: â€”</p>
              </div>
            </div>

            <h1 id="account-overview" class="dashboard__title">Account Overview</h1>

            <div class="balances" role="list">
              <div class="balance-card" role="listitem"><h3>Checking</h3><p class="balance-amount" id="checking-balance">$62,345.67</p></div>
              <div class="balance-card" role="listitem"><h3>Savings</h3><p class="balance-amount" id="savings-balance">$758,910.11</p></div>
            </div>

            <!-- Primary actions -->
            <section class="primary-actions" aria-label="Primary account actions">
              <div class="primary-pair" role="group" aria-label="Primary transfers">
                <button class="btn-primary-large" id="act-withdraw" aria-label="Withdraw">
                  <img src="assets/withdraw.svg" alt="" class="icon-large" />
                  <span class="label-large">Withdraw</span>
                </button>

                <div class="primary-spacer" aria-hidden="true"></div>

                <button class="btn-primary-large alt" id="act-transfer" aria-label="Transfer">
                  <img src="assets/transfer.png" alt="" class="icon-large" />
                  <span class="label-large">Transfer</span>
                </button>
              </div>
            </section>

            <!-- TRANSACTIONS -->
            <section class="transactions-section" aria-labelledby="recent-tx">
              <div class="section-header">
                <h2 id="recent-tx">Recent Transactions</h2>
                <div class="section-controls">
                  <input id="tx-mini-search" class="tx-mini-search" type="search" placeholder="Search recent" aria-label="Search recent transactions" />
                  <button id="tx-toggle" class="btn-secondary" aria-expanded="false">View All</button>
                </div>
              </div>

              <div class="transactions-table-wrapper" id="tx-table-wrapper" aria-hidden="false">
                <table class="transactions" role="table" aria-label="Recent transactions">
                  <thead>
                    <tr><th scope="col">Date</th><th scope="col">Description</th><th scope="col" class="text-right">Amount</th><th scope="col" class="text-right">Balance</th></tr>
                  </thead>
                  <tbody id="tx-tbody"><!-- injected by script --></tbody>
                </table>
              </div>

              <div class="tx-cards" id="tx-cards" aria-hidden="true"><!-- injected by script --></div>

              <!-- Card preview -->
              <section class="card-section" aria-label="Card preview" style="margin-top:14px">
                <div class="card-wrap">
                  <figure class="cg-card" id="cg-card" role="img" aria-label="Credit card preview">
                    <div class="cg-top">
                      <div class="cg-chip" aria-hidden="true"></div>
                      <div class="cg-contactless" aria-hidden="true">â€¢â€¢â€¢</div>
                      <div class="cg-issuer">CITI</div>
                    </div>

                    <div class="cg-number" id="cg-number" aria-hidden="true">
                      <span class="g-n">5429</span><span class="g-n">****</span><span class="g-n">****</span><span class="g-last" id="cg-last">8002</span>
                    </div>

                    <div class="cg-bottom">
                      <div class="cg-left">
                        <div class="cg-label">Cardholder</div>
                        <div class="cg-name" id="cg-name-display">HART GIJS</div>
                      </div>
                      <div class="cg-right">
                        <div class="cg-label">Valid</div>
                        <div class="cg-dates" id="cg-dates">05/27</div>
                        <div class="cg-brand" aria-hidden="true">
                          <svg width="56" height="36" viewBox="0 0 56 36"><circle cx="20" cy="18" r="12" fill="#ff4b3e"/><circle cx="36" cy="18" r="12" fill="#ffcd00" opacity="0.95"/></svg>
                        </div>
                      </div>
                    </div>
                  </figure>
                </div>
              </section>
            </section>

            <!-- Settings -->
            <section id="settings" class="settings-section" style="margin-top:18px">
              <h2>Account Settings</h2>
              <form class="settings-form" id="settings-form" novalidate>
                <label for="email">Email</label>
                <input id="email" type="email" placeholder="you@example.com" />
                <label for="password">New Password</label>
                <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
                <button type="submit" class="btn-primary">Save Changes</button>
                <p class="security-note">CITI uses bank-level TLS 1.3 encryption and supports two-factor authentication.</p>
              </form>
            </section>

          </div>
        </div>
      </section>

      <!-- RIGHT COLUMN -->
      <aside class="side-column">
        <div class="mini-card">
          <h4>Cards</h4>
          <div class="card-preview" role="group" aria-label="Primary card">
            <div style="display:flex;justify-content:space-between"><div style="opacity:0.9">Primary</div><div style="font-weight:700">â€¢â€¢â€¢â€¢ 3364</div></div>
            <div style="font-weight:700">$12,345.67</div>
          </div>
        </div>

        <div class="mini-card account-utilities">
          <button class="utilities-toggle" id="utilities-toggle" aria-expanded="false" style="display:none">Account Utilities</button>
          <div class="utilities-inner" id="utilities-inner">
            <h4>Quick actions</h4>
            <div style="display:flex;flex-direction:column;gap:8px">
              <a href="#security" class="quick-link">Security & Privacy</a>
              <a href="#limits" class="quick-link">Transaction limits</a>
              <a href="#banking" class="quick-link">Bank details</a>
            </div>
          </div>
        </div>

        <div class="mini-card">
          <h4>Two Factor Authentication</h4>
          <div style="color:var(--muted);margin-top:8px">Protect your account with 2FA. Recommended.</div>
          <div style="margin-top:12px;display:flex;gap:10px">
            <button class="btn-primary" id="enable-2fa">Get Started</button>
            <button class="btn-secondary btn-ghost" id="learn-2fa">Learn</button>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <!-- Drawer (All Transactions) -->
  <aside class="transactions-drawer" id="tx-drawer" aria-hidden="true">
    <div class="drawer-backdrop" id="tx-backdrop" tabindex="-1"></div>
    <div class="drawer-shell" role="document" aria-modal="true">
      <header class="drawer-head">
        <div><h3 class="drawer-title">All Transactions</h3><div class="drawer-sub muted">Search, filter, and export your full history</div></div>

        <div class="drawer-actions" style="display:flex;gap:8px;align-items:center">
          <div style="position:relative">
            <input id="tx-search" class="tx-search" type="search" placeholder="Search description, amount or date" aria-label="Search transactions" />
            <button id="tx-clear-search" class="btn-icon" title="Clear search" aria-label="Clear search">âœ•</button>
          </div>

          <div style="display:flex;gap:8px;align-items:center">
            <select id="tx-filter-type" aria-label="Filter by type"><option value="all">All</option><option value="credit">Credit</option><option value="debit">Debit</option><option value="pending">Pending</option></select>
            <input id="tx-date-from" type="date" class="date-input" aria-label="Date from" />
            <input id="tx-date-to" type="date" class="date-input" aria-label="Date to" />
          </div>

          <div style="display:flex;gap:8px;align-items:center">
            <button id="tx-export" class="btn-ghost" aria-label="Export transactions">Export</button>
            <button id="drawer-close" class="btn-close" aria-label="Close transactions">&times;</button>
          </div>
        </div>
      </header>

      <div class="drawer-body" id="tx-drawer-body">
        <div class="drawer-table-wrap">
          <table class="drawer-table" id="drawer-table" role="table" aria-label="Transaction history">
            <thead><tr><th>Date</th><th>Description</th><th class="text-right">Amount</th><th class="text-right">Balance</th></tr></thead>
            <tbody id="drawer-tbody"><!-- injected --></tbody>
          </table>
        </div>

        <div class="drawer-footer">
          <div class="pager">
            <button id="tx-prev" class="pager-btn" aria-label="Previous page">â€¹</button>
            <div class="pager-info"><span id="tx-page">1</span> / <span id="tx-pages">1</span></div>
            <button id="tx-next" class="pager-btn" aria-label="Next page">â€º</button>
          </div>
          <div class="drawer-note muted">Showing <span id="tx-count">0</span> transactions</div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Footer -->
  <footer class="site-footer-adv" role="contentinfo">
    <div class="footer-inner">
      <div class="trust-row">
        <div class="trust-badge" aria-hidden="true">ðŸ”·</div>
        <div class="footer-meta">
          <div class="footer-brand">Â© <span id="footer-year-adv"></span> CITI - 2025</div>
        </div>
      </div>
      <nav class="footer-links" aria-label="Footer">
        <a href="/privacy.html">Privacy</a>
        <a href="/terms.html" style="margin-left:16px">Terms</a>
        <a href="/support.html" style="margin-left:16px">Support</a>
      </nav>
    </div>
  </footer>

<script>
/* ----------------------
   Helpers (single copy)
   ---------------------- */
function fmtAmount(val){
  if (val === 0) return 'â€”';
  const abs = Math.abs(val).toLocaleString(undefined,{minimumFractionDigits:2});
  return (val < 0 ? 'âˆ’' : '+') + abs;
}
function formatLoginTimeISO(date){
  const opts = { month:'short', day:'numeric', year:'numeric', hour:'numeric', minute:'2-digit', hour12:true };
  return new Intl.DateTimeFormat('en-US', opts).format(date).replace(',', '').replace(' ', ' @ ');
}

/* Read transactions from global array or table rows */
function sourceTransactions(){
  if (window.transactions && Array.isArray(window.transactions)) return window.transactions.slice();
  const rows = Array.from(document.querySelectorAll('table.transactions tbody tr'));
  if (!rows.length) return [];
  return rows.map(r => {
    const td = r.querySelectorAll('td');
    const amountRaw = (td[2]?.textContent || '').trim();
    const amount = parseFloat(amountRaw.replace(/[^0-9\.\-]/g,'')) || 0;
    return {
      date: (td[0]?.textContent || '').trim(),
      desc: (td[1]?.textContent || '').trim(),
      amountRaw,
      amount,
      balance: (td[3]?.textContent || '').trim(),
      time: ''
    };
  });
}

/* ----------------------
   App initialization
   ---------------------- */
document.addEventListener('DOMContentLoaded', () => {
  // Footer year (preserve element id usage)
  const fy = document.getElementById('footer-year-adv');
  if (fy) fy.textContent = new Date().getFullYear();

  // Last login: read / display / persist
  (function(){
    const key = 'lastLogin';
    const stored = localStorage.getItem(key);
    const lastLoginEl = document.getElementById('last-login');
    const now = new Date();
    let dateObj = stored ? new Date(stored) : now;
    if (isNaN(dateObj.getTime())) dateObj = now;
    if (lastLoginEl) lastLoginEl.textContent = 'Last login: ' + formatLoginTimeISO(dateObj);
    try { localStorage.setItem(key, new Date().toISOString()); } catch(e){}
  })();

  // Render recent transactions into table and cards
  function renderTxTableRows(txs){
    const tbody = document.getElementById('tx-tbody');
    if (!tbody) return;
    tbody.innerHTML = txs.slice(0,3).map(tx => `
      <tr>
        <td>${tx.date}${tx.time ? ' â€¢ ' + tx.time : ''}</td>
        <td>${tx.desc}</td>
        <td class="amount ${tx.amount < 0 ? 'negative' : (tx.amount > 0 ? 'positive' : '')} text-right">${tx.amountRaw ?? fmtAmount(tx.amount)}</td>
        <td class="text-right">${tx.balance || ''}</td>
      </tr>
    `).join('');
  }

  function renderTxCards(txs){
    const cards = document.getElementById('tx-cards');
    if (!cards) return;
    cards.innerHTML = txs.slice(0,6).map(tx => `
      <div class="tx-card" role="article">
        <div>
          <div class="tx-date">${tx.date}${tx.time ? ' â€¢ ' + tx.time : ''}</div>
          <div class="tx-desc">${tx.desc}</div>
        </div>
        <div style="text-align:right">
          <div class="tx-amount ${tx.amount < 0 ? 'negative' : 'positive'}">${tx.amountRaw ?? fmtAmount(tx.amount)}</div>
          <div class="tx-balance" style="font-size:.8rem;color:var(--muted)">${tx.balance||''}</div>
        </div>
      </div>
    `).join('');
  }

  // Drawer module (filters, pagination, export) â€” single consolidated instance
  (function drawerModule(){
    const btnViewAll = document.getElementById('tx-toggle');
    const drawer = document.getElementById('tx-drawer');
    const drawerBackdrop = document.getElementById('tx-backdrop');
    const drawerClose = document.getElementById('drawer-close');
    const drawerTbody = document.getElementById('drawer-tbody');

    const txSearch = document.getElementById('tx-search');
    const txClear = document.getElementById('tx-clear-search');
    const filterType = document.getElementById('tx-filter-type');
    const dateFrom = document.getElementById('tx-date-from');
    const dateTo = document.getElementById('tx-date-to');
    const exportBtn = document.getElementById('tx-export');

    let page = 1, pageSize = 10, filtered = [];

    function applyFilters(list){
      const q = (txSearch?.value || '').trim().toLowerCase();
      const type = filterType?.value || 'all';
      const from = dateFrom?.value ? new Date(dateFrom.value) : null;
      const to = dateTo?.value ? new Date(dateTo.value) : null;

      return list.filter(item => {
        if (type !== 'all') {
          if (type === 'credit' && item.amount < 0) return false;
          if (type === 'debit' && item.amount > 0) return false;
          if (type === 'pending' && !(item.status && item.status.toLowerCase().includes('pending'))) return false;
        }
        if (from || to) {
          const parsed = new Date(item.date);
          if (from && parsed < from) return false;
          if (to && parsed > new Date(to.getTime() + 86400000)) return false;
        }
        if (!q) return true;
        return [item.date, item.desc, String(item.amount), item.balance, item.status].join(' ').toLowerCase().includes(q);
      });
    }

    function renderDrawerPage(){
      const list = filtered;
      const pages = Math.max(1, Math.ceil(list.length / pageSize));
      if (page > pages) page = pages;
      const start = (page -1) * pageSize;
      const slice = list.slice(start, start + pageSize);

      document.getElementById('tx-page').textContent = page;
      document.getElementById('tx-pages').textContent = pages;
      document.getElementById('tx-count').textContent = list.length;

      if (!drawerTbody) return;
      drawerTbody.innerHTML = slice.map(tx => `
        <tr>
          <td>${tx.date}${tx.time ? ' â€¢ ' + tx.time : ''}</td>
          <td>${tx.desc}</td>
          <td class="text-right ${tx.amount < 0 ? 'amount negative' : 'amount positive'}">${tx.amountRaw ?? fmtAmount(tx.amount)}</td>
          <td class="text-right">${tx.balance || ''}</td>
        </tr>
      `).join('') || '<tr><td colspan="4" style="padding:18px;color:var(--muted)">No transactions found</td></tr>';
    }

    function refreshFiltered(){
      filtered = applyFilters(sourceTransactions());
      page = 1;
      renderDrawerPage();
    }

    function openDrawer(){
      refreshFiltered();
      drawer.classList.add('open');
      drawer.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      setTimeout(()=> txSearch?.focus(), 120);
      btnViewAll?.setAttribute('aria-expanded','true');
    }
    function closeDrawer(){
      drawer.classList.remove('open');
      drawer.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      btnViewAll?.setAttribute('aria-expanded','false');
      btnViewAll?.focus();
    }

    btnViewAll?.addEventListener('click', ()=> drawer.classList.contains('open') ? closeDrawer() : openDrawer());
    drawerClose?.addEventListener('click', closeDrawer);
    drawerBackdrop?.addEventListener('click', closeDrawer);

    // mini-search filters table rows
    document.getElementById('tx-mini-search')?.addEventListener('input', (e) => {
      const q = e.target.value.trim().toLowerCase();
      const rows = Array.from(document.querySelectorAll('table.transactions tbody tr'));
      rows.forEach(tr => {
        const txt = tr.textContent.toLowerCase();
        tr.style.display = (!q || txt.includes(q)) ? '' : 'none';
      });
    });

    // Debounce helper
    let tid;
    function debounce(fn,ms=220){ return (...a)=>{ clearTimeout(tid); tid = setTimeout(()=>fn(...a), ms); }; }
    const onFilterChange = debounce(()=> refreshFiltered(), 220);

    txSearch?.addEventListener('input', onFilterChange);
    txClear?.addEventListener('click', ()=> { if (txSearch){ txSearch.value=''; refreshFiltered(); txSearch.focus(); }});
    filterType?.addEventListener('change', onFilterChange);
    dateFrom?.addEventListener('change', onFilterChange);
    dateTo?.addEventListener('change', onFilterChange);

    document.getElementById('tx-prev')?.addEventListener('click', ()=> { if (page>1){ page--; renderDrawerPage(); }});
    document.getElementById('tx-next')?.addEventListener('click', ()=> { const pages = Math.max(1, Math.ceil(filtered.length/pageSize)); if (page<pages){ page++; renderDrawerPage(); }});

    exportBtn?.addEventListener('click', ()=> {
      const rows = filtered.map(tx => [tx.date, tx.time||'', tx.desc, tx.amountRaw ?? tx.amount, tx.balance || '']);
      const csv = [['Date','Time','Description','Amount','Balance'], ...rows].map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `transactions_${new Date().toISOString().slice(0,10)}.csv`; document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 400);
    });

    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && drawer?.classList.contains('open')) closeDrawer(); });

    window.refreshTransactionDrawer = refreshFiltered;
  })();

  // Initial render of transactions in table/cards
  const initialTx = sourceTransactions();
  renderTxTableRows(initialTx);
  renderTxCards(initialTx);

  // Settings form (placeholder preserve)
  const settingsForm = document.getElementById('settings-form');
  if (settingsForm){
    settingsForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const btn = settingsForm.querySelector('button[type="submit"]');
      const prev = btn.textContent;
      btn.disabled = true; btn.textContent = 'Savingâ€¦';
      setTimeout(()=> { btn.disabled=false; btn.textContent=prev; alert('Settings saved'); }, 700);
    });
  }

  // Action wiring (preserve mapping)
  const map = { 'act-deposit':'/deposit.html', 'act-withdraw':'/withdraw.html', 'act-transfer':'/transfer.html', 'act-trade':'/trade.html' };
  Object.keys(map).forEach(id => {
    const el = document.getElementById(id);
    if (el) el.addEventListener('click', () => { window.location.href = map[id]; });
  });

  // 2FA CTAs
  document.getElementById('enable-2fa')?.addEventListener('click', ()=> { alert('Begin 2FA setup flow'); });
  document.getElementById('learn-2fa')?.addEventListener('click', ()=> { location.href='/2fa-info.html'; });

  // Overlay menu wiring
  const navBtn = document.getElementById('nav-toggle');
  const menuOverlay = document.getElementById('menu-overlay');
  const overlayClose = document.getElementById('overlay-close');
  const overlayBackdrop = document.getElementById('overlay-backdrop');
  if (navBtn && menuOverlay) {
    navBtn.addEventListener('click', () => { menuOverlay.style.display = 'block'; menuOverlay.setAttribute('aria-hidden','false'); });
  }
  if (overlayClose) overlayClose.addEventListener('click', () => { menuOverlay.style.display = 'none'; menuOverlay.setAttribute('aria-hidden','true'); });
  if (overlayBackdrop) overlayBackdrop.addEventListener('click', () => { menuOverlay.style.display = 'none'; menuOverlay.setAttribute('aria-hidden','true'); });

  // Utilities toggle for mobile
  (function(){
    const toggle = document.getElementById('utilities-toggle');
    const inner = document.getElementById('utilities-inner');
    if (!toggle || !inner) return;
    // show toggle only on small screens (CSS hides by default)
    toggle.style.display = window.matchMedia('(max-width:1100px)').matches ? 'block' : 'none';
    toggle.addEventListener('click', ()=> {
      const collapsed = inner.classList.toggle('collapsed');
      toggle.setAttribute('aria-expanded', String(!collapsed));
    });
    // update on resize
    window.addEventListener('resize', ()=> toggle.style.display = window.matchMedia('(max-width:1100px)').matches ? 'block' : 'none');
  })();

  // Responsive tx presentation
  function syncTxPresentation(){
    const small = window.matchMedia('(max-width:1100px)').matches;
    const tableWrap = document.getElementById('tx-table-wrapper');
    const cards = document.getElementById('tx-cards');
    if (tableWrap) tableWrap.style.display = small ? 'none' : 'block';
    if (cards) cards.style.display = small ? 'block' : 'none';
  }
  window.addEventListener('resize', syncTxPresentation);
  syncTxPresentation();

}); // DOMContentLoaded end
</script>
</body>
</html>
